<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.connor.hozon.bom.bomSystem.dao.project.HzSuperMaterielDao">
    <resultMap id="BaseResultMap" type="sql.pojo.project.HzMaterielRecord">
        <id column="PUID" jdbcType="VARCHAR" property="puid"/>
        <result column="P_MATERIEL_CODE" jdbcType="OTHER" property="pMaterielCode"/>
        <result column="P_MATERIEL_TYPE" jdbcType="OTHER" property="pMaterielType"/>
        <result column="P_MATERIEL_WERK" jdbcType="OTHER" property="pMaterielWerk"/>
        <result column="P_MATERIEL_DESC" jdbcType="OTHER" property="pMaterielDesc"/>
        <result column="P_PERTAIN_TO_PROJECT_PUID" jdbcType="VARCHAR" property="pPertainToProjectPuid"/>
    </resultMap>

    <!--物料数据信息-->
    <resultMap  extends="BaseResultMap" id="HzMaterielRecordMap" type="sql.pojo.project.HzMaterielRecord">
        <result column="P_MATERIEL_DESC_EN" jdbcType="VARCHAR" property="pMaterielDescEn" />
        <result column="P_BASIC_UNIT_MEASURE" jdbcType="VARCHAR" property="pBasicUnitMeasure" />
        <result column="P_INVENTED_PART" jdbcType="INTEGER" property="pInventedPart" />
        <result column="P_SPARE_MATERIAL" jdbcType="VARCHAR" property="pSpareMaterial" />
        <result column="P_VIN_PER_NO" jdbcType="VARCHAR" property="pVinPerNo" />
        <result column="P_COLOR_PART" jdbcType="INTEGER" property="pColorPart" />
        <result column="P_HEIGHT" jdbcType="VARCHAR" property="pHeight" />
        <result column="P_IN_OUT_SIDE_FLAG" jdbcType="INTEGER" property="pInOutSideFlag" />
        <result column="P_3C_PART_FLAG" jdbcType="INTEGER" property="p3cPartFlag" />
        <result column="P_MRP_CONTROLLER" jdbcType="VARCHAR" property="pMrpController" />
        <result column="P_PART_IMPORTANT_DEGREE" jdbcType="VARCHAR" property="pPartImportantDegree" />
        <result column="P_LOOSE_PART_FLAG" jdbcType="INTEGER" property="pLoosePartFlag" />
        <result column="P_VALID_FLAG" jdbcType="INTEGER" property="pValidFlag" />
        <result column="P_MATERIEL_DATA_TYPE" jdbcType="INTEGER" property="pMaterielDataType" />
        <result column="P_CREATE_NAME" jdbcType="VARCHAR" property="pCreateName" />
        <result column="P_UPDATE_NAME" jdbcType="VARCHAR" property="pUpdateName" />
        <result column="P_FACTORY_PUID" jdbcType="VARCHAR" property="pFactoryPuid" />
        <result column="P_RESOURCE" jdbcType="VARCHAR" property="resource" />
        <result column="P_TYPE" jdbcType="INTEGER" property="type" />
        <result column="P_MATERIEL_RESOURCE_ID" jdbcType="VARCHAR" property="materielResourceId" />

    </resultMap>

    <!--整车衍生物料主数据-->
    <resultMap id="HzCfg0ModelRecordMap" type="sql.pojo.cfg.HzCfg0ModelRecord">
        <id column="PUID" jdbcType="VARCHAR" property="puid" />
        <result column="OBJECT_NAME" jdbcType="OTHER" property="objectName" />
        <result column="OBJECT_DESC" jdbcType="OTHER" property="objectDesc" />
        <result column="P_CFG0_MODEL_OF_MAIN_RECORD" jdbcType="VARCHAR" property="pCfg0ModelOfMainRecord" />
        <result column="P_CFG0_MODEL_BASIC_DETAIL" jdbcType="VARCHAR" property="pCfg0ModelBasicDetail" />
    </resultMap>

    <!--半成品、虚拟件、生产性外购、自制备件物料主数据-->
    <resultMap id="HzMbomRecordMap" type="sql.pojo.bom.HzMbomLineRecord">
        <result column="PUID" jdbcType="VARCHAR" property="puid"/>
        <result column="P_BOM_PUID" jdbcType="VARCHAR" property="eBomPuid"/>
        <result column="P_SPARE_PART" jdbcType="VARCHAR" property="sparePart"/>
        <result column="P_SPARE_PART_NUM" jdbcType="VARCHAR" property="sparePartNum"/>
        <result column="P_PROCESS_ROUTE" jdbcType="VARCHAR" property="processRoute"/>
        <result column="P_LABOR_HOUR" jdbcType="VARCHAR" property="laborHour"/>
        <result column="P_RHYTHM" jdbcType="VARCHAR" property="rhythm"/>
        <result column="P_SOLDER_JOINT" jdbcType="VARCHAR" property="solderJoint"/>
        <result column="P_MACHINE_MATERIAL" jdbcType="VARCHAR" property="machineMaterial"/>
        <result column="P_STANDARD_PART" jdbcType="VARCHAR" property="standardPart"/>
        <result column="P_TOOLS" jdbcType="VARCHAR" property="tools"/>
        <result column="P_WASTER_PRODUCT" jdbcType="VARCHAR" property="wasterProduct"/>
        <result column="P_CHANGE" jdbcType="VARCHAR" property="change"/>
        <result column="P_MBOM_STATUS" jdbcType="INTEGER" property="status"/>
        <result column="P_CHANGE_NUM" jdbcType="VARCHAR" property="changeNum"/>
        <result column="P_CREATE_TIME" jdbcType="DATE" property="createTime"/>
        <result column="P_UPDATE_TIME" jdbcType="DATE" property="updateTime"/>
        <result column="P_CREATE_NAME" jdbcType="VARCHAR" property="createName"/>
        <result column="P_UPDATE_NAME" jdbcType="VARCHAR" property="updateName"/>

        <result column="P_PARENT_UID" jdbcType="VARCHAR" property="parentUid" />
        <result column="P_BOM_DIGIFAX_ID" jdbcType="VARCHAR" property="bomDigifaxId" />
        <result column="P_LINE_INDEX" jdbcType="VARCHAR" property="lineIndex" />
        <result column="P_BOM_LINE_IS_HAS" jdbcType="INTEGER" property="isHas" />
        <result column="P_BOM_LINE_PUID" jdbcType="VARCHAR" property="linePuid" />
        <result column="P_BOM_LINE_ID" jdbcType="VARCHAR" property="lineId" />
        <result column="P_BOM_LINE_IS_2Y" jdbcType="INTEGER" property="is2Y" />
        <result column="P_BOM_LINE_IS_PART" jdbcType="INTEGER" property="isPart" />
        <result column="P_BOM_LINE_IS_DEPT" jdbcType="INTEGER" property="isDept" />
        <result column="P_BOM_OF_WHICH_DEPT" jdbcType="VARCHAR" property="pBomOfWhichDept" />
        <result column="P_BOM_LINE_PART_NAME" jdbcType="VARCHAR" property="pBomLinePartName" />
        <result column="P_BOM_LINE_PART_CLASS" jdbcType="VARCHAR" property="pBomLinePartClass" />
        <result column="P_BOM_LINE_PART_EN_NAME" jdbcType="VARCHAR" property="pBomLinePartEnName" />
        <result column="P_BOM_LINE_PART_RESOURCE" jdbcType="VARCHAR" property="pBomLinePartResource" />
        <result column="P_BOM_ORDER_NUM" jdbcType="INTEGER" property="orderNum" />

        <result column="P_BOM_TYPE" jdbcType="DECIMAL" property="pBomType" />
        <result column="P_STOCK_LOCATION" jdbcType="VARCHAR" property="pStockLocation" />
        <result column="P_FACTORY_ID" jdbcType="VARCHAR" property="pFactoryId" />
    </resultMap>


    <sql id="Base_Column_List">
    PUID, P_MATERIEL_CODE, P_MATERIEL_TYPE, P_MATERIEL_WERK, P_MATERIEL_DESC, P_PERTAIN_TO_PROJECT_PUID
  </sql>


    <!--整车衍生物料主数据-->
    <sql id="HzCfg0ModelRecordList">
    PUID, OBJECT_NAME, OBJECT_DESC, P_CFG0_MODEL_OF_MAIN_RECORD, P_CFG0_MODEL_BASIC_DETAIL
  </sql>

    <!--半成品、虚拟件、生产性外购、自制备件物料主数据-->
    <sql id="HzMbomRecordList">
        PUID, P_SPARE_PART, P_SPARE_PART_NUM, P_PROCESS_ROUTE, P_LABOR_HOUR, P_RHYTHM,
        P_SOLDER_JOINT, P_MACHINE_MATERITAL, P_STANDARD_PART, P_TOOLS, P_WASTER_PRODUCT,
        P_CHANGE, P_CHANGE_NUM, P_BOM_PUID, P_MBOM_STATUS, P_CREATE_TIME, P_UPDATE_TIME,
        P_CREATE_NAME, P_UPDATE_NAME, P_PARENT_UID, P_BOM_DIGIFAX_ID, P_LINE_INDEX, P_BOM_LINE_IS_HAS,
        P_BOM_LINE_PUID, P_BOM_LINE_ID, P_BOM_LINE_IS_2Y, P_BOM_LINE_IS_PART, P_BOM_LINE_IS_DEPT,
        P_BOM_OF_WHICH_DEPT, P_BOM_LINE_PART_NAME, P_BOM_LINE_PART_CLASS, P_BOM_LINE_PART_EN_NAME,
        P_BOM_LINE_PART_RESOURCE, P_BOM_ORDER_NUM,P_BOM_TYPE, P_STOCK_LOCATION,P_FACTORY_ID
	</sql>

    <!--物料主数据-->
    <sql id="HzMaterielRecordList">
     PUID, P_MATERIEL_CODE,P_RESOURCE, P_MATERIEL_TYPE, P_MATERIEL_WERK, P_MATERIEL_DESC, P_PERTAIN_TO_PROJECT_PUID,
    P_MATERIEL_DESC_EN, P_BASIC_UNIT_MEASURE, P_INVENTED_PART, P_SPARE_MATERIAL, P_VIN_PER_NO,
    P_COLOR_PART, P_HEIGHT, P_IN_OUT_SIDE_FLAG, P_3C_PART_FLAG, P_MRP_CONTROLLER, P_PART_IMPORTANT_DEGREE,
    P_LOOSE_PART_FLAG, P_VALID_FLAG, P_MATERIEL_DATA_TYPE, P_CREATE_TIME, P_UPDATE_TIME,
    P_CREATE_NAME, P_UPDATE_NAME, P_FACTORY_PUID,P_MATERIEL_RESOURCE_ID,P_TYPE
  </sql>
    
    <select id="selectByPrimaryKey" parameterType="java.lang.String" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from HZ_MATERIEL_RECORD
        where PUID = #{puid,jdbcType=VARCHAR}
    </select>
    
    
    <select id="selectByProjectPuid" parameterType="java.lang.String" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from HZ_MATERIEL_RECORD
        where P_PERTAIN_TO_PROJECT_PUID = #{pPertainToProjectPuid,jdbcType=VARCHAR}
    </select>
    
    
    
    
    <insert id="insert" parameterType="sql.pojo.project.HzMaterielRecord">
    insert into HZ_MATERIEL_RECORD (PUID, P_MATERIEL_CODE, P_MATERIEL_TYPE, 
      P_MATERIEL_WERK, P_MATERIEL_DESC, P_PERTAIN_TO_PROJECT_PUID
      )
    values (#{puid,jdbcType=VARCHAR}, #{pMaterielCode,jdbcType=OTHER}, #{pMaterielType,jdbcType=OTHER}, 
      #{pMaterielWerk,jdbcType=OTHER}, #{pMaterielDesc,jdbcType=OTHER}, #{pPertainToProjectPuid,jdbcType=VARCHAR}
      )
  </insert>
    
    <update id="updateByPrimaryKey" parameterType="sql.pojo.project.HzMaterielRecord">
    update HZ_MATERIEL_RECORD
    set P_MATERIEL_CODE = #{pMaterielCode,jdbcType=OTHER},
      P_MATERIEL_TYPE = #{pMaterielType,jdbcType=OTHER},
      P_MATERIEL_WERK = #{pMaterielWerk,jdbcType=OTHER},
      P_MATERIEL_DESC = #{pMaterielDesc,jdbcType=OTHER},
      P_PERTAIN_TO_PROJECT_PUID = #{pPertainToProjectPuid,jdbcType=VARCHAR}
    where PUID = #{puid,jdbcType=VARCHAR}
  </update>

    <!--编辑一条记录-->
    <update id="HzMaterialDAOImpl_update" parameterType="sql.pojo.project.HzMaterielRecord">
        update HZ_MATERIEL_RECORD
        <set>
            <if test="pSpareMaterial != null">
                P_SPARE_MATERIAL = #{pSpareMaterial,jdbcType=VARCHAR},
            </if>
            <if test="pVinPerNo != null">
                P_VIN_PER_NO = #{pVinPerNo,jdbcType=VARCHAR},
            </if>
            <if test="pMrpController != null">
                P_MRP_CONTROLLER = #{pMrpController,jdbcType=VARCHAR},
            </if>
            <if test="pLoosePartFlag != null">
                P_LOOSE_PART_FLAG = #{pLoosePartFlag,jdbcType=INTEGER},
            </if>
                P_UPDATE_TIME = sysdate,
            <if test="pUpdateName != null">
                P_UPDATE_NAME = #{pUpdateName,jdbcType=VARCHAR},
            </if>
            <if test="pFactoryPuid != null">
                P_FACTORY_PUID = #{pFactoryPuid,jdbcType=VARCHAR},
            </if>
        </set>
        where PUID = #{puid,jdbcType=VARCHAR}
    </update>

    <!--删除一条记录-->
    <update id="HzMaterialDAOImpl_delete" parameterType="java.lang.String">
        update HZ_MATERIEL_RECORD
        set
        P_VALID_FLAG = 0
        where PUID = #{puid,jdbcType=VARCHAR}
    </update>

    <!--查询一条记录-->
    <select id="selectByPrimaryKey111" parameterType="java.lang.String" resultMap="BaseResultMap">
        select
        <include refid="HzMaterielRecordList" />
        from HZ_MATERIEL_RECORD
        where PUID = #{puid,jdbcType=VARCHAR}
    </select>

    <!--批量插入-->
    <insert id="HzMaterialDAOImpl_insertList" useGeneratedKeys="false" parameterType="java.util.List">
        insert into HZ_MATERIEL_RECORD (PUID, P_MATERIEL_CODE, P_MATERIEL_TYPE,
        P_MATERIEL_DESC, P_PERTAIN_TO_PROJECT_PUID, P_MATERIEL_DESC_EN,P_MATERIEL_DATA_TYPE,
        P_FACTORY_PUID,P_TYPE,P_MATERIEL_RESOURCE_ID,P_VALID_FLAG)
        <foreach collection="list" item="item" index="index" separator="UNION ALL">
            select
            #{item.puid,jdbcType=VARCHAR}, #{item.pMaterielCode,jdbcType=VARCHAR}, #{item.pMaterielType,jdbcType=VARCHAR},
            #{item.pMaterielDesc,jdbcType=VARCHAR}, #{item.pPertainToProjectPuid,jdbcType=VARCHAR}, #{item.pMaterielDescEn,jdbcType=VARCHAR},
            #{item.pMaterielDataType,jdbcType=VARCHAR}, #{item.pFactoryPuid,jdbcType=VARCHAR},#{item.type,jdbcType=INTEGER},
            #{item.materielResourceId,jdbcType=INTEGER},1
            from DUAL
        </foreach>
    </insert>



    <!--分页获取物料主数据-->
    <select id="HzMaterialDAOImpl_findHzMaterielForPage" parameterType="java.util.HashMap" resultMap="HzMaterielRecordMap">
        select * from
        (select t.*,ROWNUM as rn from
        (select
        <include refid="HzMaterielRecordList"/>
        from HZ_MATERIEL_RECORD
        <where>
            1=1
            <if test="projectId != null and projectId!=''">
                and P_PERTAIN_TO_PROJECT_PUID = #{projectId,jdbcType=VARCHAR}
            </if>
            <if test="pMaterielDataType != null">
                and P_MATERIEL_DATA_TYPE = #{pMaterielDataType,jdbcType=INTEGER}
            </if>
            <if test="pMaterielCode != null">
                and P_MATERIEL_CODE like CONCAT(CONCAT('%',#{pMaterielCode,jdbcType=VARCHAR}),'%')
            </if>
            <if test="pMaterielType != null">
                and P_MATERIEL_TYPE like CONCAT(CONCAT('%',#{pMaterielType,jdbcType=VARCHAR}),'%')
            </if>
            and P_VALID_FLAG =1
        </where>
        )t
        WHERE ROWNUM &lt;=#{limit,jdbcType=INTEGER}) where rn &gt;#{offset,jdbcType=INTEGER}
    </select>

    <!--获取物料主数据总数-->
    <select id="HzMaterialDAOImpl_findHzMaterielTotalCount" parameterType="java.util.HashMap" resultType="java.lang.Integer">
        select
        count(*)
        from HZ_MATERIEL_RECORD
        <where>
            1=1
            <if test="projectId != null and projectId!=''">
                and P_PERTAIN_TO_PROJECT_PUID = #{projectId,jdbcType=VARCHAR}
            </if>
            <if test="pMaterielDataType != null">
                and P_MATERIEL_DATA_TYPE = #{pMaterielDataType,jdbcType=INTEGER}
            </if>
            <if test="pMaterielCode != null">
                and P_MATERIEL_CODE like CONCAT(CONCAT('%',#{pMaterielCode,jdbcType=VARCHAR}),'%')
            </if>
            <if test="pMaterielType != null">
                and P_MATERIEL_TYPE like CONCAT(CONCAT('%',#{pMaterielType,jdbcType=VARCHAR}),'%')
            </if>
            and P_VALID_FLAG =1
        </where>
    </select>



    <!--获取物料主数据-->
    <select id="HzMaterialDAOImpl_findHzMaterielForList" parameterType="java.util.HashMap" resultMap="HzMaterielRecordMap">
        select
        <include refid="HzMaterielRecordList" />
        from HZ_MATERIEL_RECORD
        <where>
            1=1
            <if test="projectId != null and projectId!=''">
               and P_PERTAIN_TO_PROJECT_PUID = #{projectId,jdbcType=VARCHAR}
            </if>
            <if test="puid != null and puid!=''">
               and PUID = #{puid,jdbcType=VARCHAR}
            </if>
            <if test="pMaterielDataType != null">
               and P_MATERIEL_DATA_TYPE = #{pMaterielDataType,jdbcType=INTEGER}
            </if>
            and P_VALID_FLAG =1
        </where>
    </select>





    <!--分页查询整车衍生物料主数据-->
    <select id="HzMaterialDAOImpl_findHzCfg0ModelRecord" parameterType="java.util.HashMap" resultMap="HzCfg0ModelRecordMap">
         select * from
        (select t.*,ROWNUM as rn from
        (SELECT t1.* FROM HZ_CFG0_MODEL_RECORD t1 WHERE t1.P_CFG0_MODEL_OF_MAIN_RECORD =
        (SELECT PUID FROM HZ_CFG0_MAIN_RECORD t2
        WHERE t2.P_CFG0_OF_WHICH_PROJECT_PUID=#{projectId,jdbcType=VARCHAR}))t
        WHERE ROWNUM &lt;=#{limit,jdbcType=INTEGER}) where rn &gt;#{offset,jdbcType=INTEGER}

    </select>


    <!--查询整车衍生物料主数据全部-->
    <select id="HzMaterialDAOImpl_findHzCfg0ModelRecordAll" parameterType="java.util.HashMap" resultMap="HzCfg0ModelRecordMap">
        SELECT t1.* FROM HZ_CFG0_MODEL_RECORD t1 WHERE t1.P_CFG0_MODEL_OF_MAIN_RECORD =
        (SELECT PUID FROM HZ_CFG0_MAIN_RECORD t2
        WHERE t2.P_CFG0_OF_WHICH_PROJECT_PUID=#{projectId,jdbcType=VARCHAR})
    </select>

    <!--分页查询虚拟件物料主数据 所有2y层级的-->
    <select id="HzMaterialDAOImpl_findHz2YMbomRecord" parameterType="java.util.HashMap" resultMap="HzMbomRecordMap">
        select * from
        (select t.*,ROWNUM as rn from
        (select
        <include refid="HzMbomRecordList" />
        from HZ_MBOM_RECORD t1
        where t1.P_BOM_DIGIFAX_ID =(
        select t2.puid from Hz_Bom_Main_Record t2
        where
        t2.p_cfg0_of_which_project_puid=#{projectId,jdbcType=VARCHAR}
        ) and LENGTH(TRANSLATE(P_LINE_INDEX,',0123456789','.'))=1
         and t1.P_BOM_LINE_IS_HAS=1 and t1.P_MBOM_STATUS=1)t
        WHERE ROWNUM &lt;=#{limit,jdbcType=INTEGER}) where rn &gt;#{offset,jdbcType=INTEGER}
    </select>



    <!--查询虚拟件物料主数据全部 所有2y层级的-->
    <select id="HzMaterialDAOImpl_findHz2YMbomRecordAll" parameterType="java.util.HashMap" resultMap="HzMbomRecordMap">

        select
        <include refid="HzMbomRecordList" />
        from HZ_MBOM_RECORD t1
        where t1.P_BOM_DIGIFAX_ID =(
        select t2.puid from Hz_Bom_Main_Record t2
        where
        t2.p_cfg0_of_which_project_puid=#{projectId,jdbcType=VARCHAR}
        ) and LENGTH(TRANSLATE(P_LINE_INDEX,',0123456789','.'))=1
        and t1.P_BOM_LINE_IS_HAS=1 and t1.P_MBOM_STATUS =1

    </select>


    <!--分页查询半成品物料主数据  零件来源为自制单件-->
    <select id="HzMaterialDAOImpl_findHzResourceMakeSingleMbomRecord" parameterType="java.util.HashMap" resultMap="HzMbomRecordMap">
        select * from
        (select t.*,ROWNUM as rn from
        (select
        <include refid="HzMbomRecordList" />
        from HZ_MBOM_RECORD t1
        where t1.P_BOM_DIGIFAX_ID =(
        select t2.puid from Hz_Bom_Main_Record t2
        where
        t2.p_cfg0_of_which_project_puid=#{projectId,jdbcType=VARCHAR}
        )
        and T1.P_BOM_LINE_PART_RESOURCE='自制单件' and t1.P_MBOM_STATUS =1
        )t
        WHERE ROWNUM &lt;=#{limit,jdbcType=INTEGER}) where rn &gt;#{offset,jdbcType=INTEGER}
    </select>



    <!--查询半成品物料主数据  零件来源为自制单件-->
    <select id="HzMaterialDAOImpl_findHzResourceMakeSingleMbomRecordAll" parameterType="java.util.HashMap" resultMap="HzMbomRecordMap">

        select
        <include refid="HzMbomRecordList" />
        from HZ_MBOM_RECORD t1
        where t1.P_BOM_DIGIFAX_ID =(
        select t2.puid from Hz_Bom_Main_Record t2
        where
        t2.p_cfg0_of_which_project_puid=#{projectId,jdbcType=VARCHAR}
        )
        and T1.P_BOM_LINE_PART_RESOURCE='自制单件'and t1.P_MBOM_STATUS =1

    </select>


    <!--分页查询生产性外购物料主数据 零件来源为采购件-->
    <select id="HzMaterialDAOImpl_findHzResourceBuyMbomRecord" parameterType="java.util.HashMap" resultMap="HzMbomRecordMap">
        select * from
        (select t.*,ROWNUM as rn from
        (select
        <include refid="HzMbomRecordList" />
        from HZ_MBOM_RECORD t1
        where P_BOM_DIGIFAX_ID =(
        select t2.puid from Hz_Bom_Main_Record t2
        where
        t2.p_cfg0_of_which_project_puid=#{projectId,jdbcType=VARCHAR}
        )
        and T1.P_BOM_LINE_PART_RESOURCE='采购件' and t1.P_MBOM_STATUS =1
        )t
        WHERE ROWNUM &lt;=#{limit,jdbcType=INTEGER}) where rn &gt;#{offset,jdbcType=INTEGER}
    </select>



    <!--查询生产性外购物料主数据全部 零件来源为采购件-->
    <select id="HzMaterialDAOImpl_findHzResourceBuyMbomRecordAll" parameterType="java.util.HashMap" resultMap="HzMbomRecordMap">
       select
        <include refid="HzMbomRecordList" />
        from HZ_MBOM_RECORD t1
        where P_BOM_DIGIFAX_ID =(
        select t2.puid from Hz_Bom_Main_Record t2
        where
        t2.p_cfg0_of_which_project_puid=#{projectId,jdbcType=VARCHAR}
        )
        and T1.P_BOM_LINE_PART_RESOURCE='采购件'and t1.P_MBOM_STATUS =1
    </select>


    <!--分页查询自制备件物料主数据 备件信息为自制 物料前需加DY标志-->
    <select id="HzMaterialDAOImpl_findHzMadeBySelfSpareMbomRecord" parameterType="java.util.HashMap" resultMap="HzMbomRecordMap">
        select * from
        (select t.*,ROWNUM as rn from
        ( select t5.* from HZ_MBOM_RECORD t5
        where t5.p_bom_digifax_id=(
        select t3.puid from Hz_Bom_Main_Record t3 where t3.p_cfg0_of_which_project_puid=(
        select t2.puid from Hz_project_libs t2
        <where>
            t2.puid=#{projectId,jdbcType=VARCHAR}))
            and t5.P_SPARE_PART ='自制'
            and t5.P_MBOM_STATUS=1
        </where>
        )t
        WHERE ROWNUM &lt;=#{limit,jdbcType=INTEGER}) where rn &gt;#{offset,jdbcType=INTEGER}
    </select>


    <!--查询自制备件物料主数据全部 备件信息为自制 物料前需加DY标志-->
    <select id="HzMaterialDAOImpl_findHzMadeBySelfSpareMbomRecordAll" parameterType="java.util.HashMap" resultMap="HzMbomRecordMap">

        select t5.* from HZ_MBOM_RECORD t5
        where t5.p_bom_digifax_id=(
        select t3.puid from Hz_Bom_Main_Record t3 where t3.p_cfg0_of_which_project_puid=(
        select t2.puid from Hz_project_libs t2
        <where>
            t2.puid=#{projectId,jdbcType=VARCHAR}))
            and t5.P_SPARE_PART ='自制'
            and t5.P_MBOM_STATUS=1
        </where>
    </select>


    <!--分页查询自制总成物料主数据-->
    <select id="HzMaterialDAOImpl_findHzMadeBySelfAssemblyMbomRecord" parameterType="java.util.HashMap" resultMap="HzMbomRecordMap">
        select * from
        (select t.*,ROWNUM as rn from
        ( select t5.* from HZ_MBOM_RECORD t5
        where t5.p_bom_digifax_id=(
        select t3.puid from Hz_Bom_Main_Record t3 where t3.p_cfg0_of_which_project_puid=(
        select t2.puid from Hz_project_libs t2
        <where>
            t2.puid=#{projectId,jdbcType=VARCHAR}))
            and t5.P_BOM_LINE_PART_RESOURCE ='自制总成'
            and t5.P_MBOM_STATUS=1
        </where>
        )t
        WHERE ROWNUM &lt;=#{limit,jdbcType=INTEGER}) where rn &gt;#{offset,jdbcType=INTEGER}
    </select>


    <!--查询自制总成物料主数据全部-->
    <select id="HzMaterialDAOImpl_findHzMadeBySelfAssemblyMbomRecordAll" parameterType="java.util.HashMap" resultMap="HzMbomRecordMap">

        select t5.* from HZ_MBOM_RECORD t5
        where t5.p_bom_digifax_id=(
        select t3.puid from Hz_Bom_Main_Record t3 where t3.p_cfg0_of_which_project_puid=(
        select t2.puid from Hz_project_libs t2
        <where>
            t2.puid=#{projectId,jdbcType=VARCHAR}))
            and t5.P_BOM_LINE_PART_RESOURCE ='自制总成'
            and t5.P_MBOM_STATUS=1
        </where>
    </select>


    <!--查询一条物料数据-->
    <select id="HzMaterialDAOImpl_getHzMaterielRecord" parameterType="java.util.HashMap" resultMap="HzMaterielRecordMap">
      select <include refid="HzMaterielRecordList"/>
       from HZ_MATERIEL_RECORD
        <where>
            1=1
            <if test="puid != null and puid!=''">
                and PUID = #{puid,jdbcType=VARCHAR}
            </if>
            <if test="projectId != null and projectId!=''">
                and P_PERTAIN_TO_PROJECT_PUID = #{projectId,jdbcType=VARCHAR}
            </if>
            <if test="pMaterielDataType != null">
                and P_MATERIEL_DATA_TYPE = #{pMaterielDataType,jdbcType=VARCHAR}
            </if>
            and P_VALID_FLAG=1
        </where>
    </select>

    <!--查找重复-->
    <select id="HzMaterialDAOImpl_HzMaterielIsExist" parameterType="java.util.HashMap" resultType="java.lang.Integer">
        select count(*) from HZ_MATERIEL_RECORD
        <where>
            1=1
            <if test="materielResourceId != null and materielResourceId!=''">
                and P_MATERIEL_RESOURCE_ID = #{materielResourceId,jdbcType=VARCHAR}
            </if>
            <if test="projectId != null and projectId !=''">
                and P_PERTAIN_TO_PROJECT_PUID = #{projectId,jdbcType=VARCHAR}
            </if>
            <if test="type != null">
                and P_TYPE = #{type,jdbcType=VARCHAR}
            </if>
            and P_VALID_FLAG=1
        </where>
    </select>
</mapper>