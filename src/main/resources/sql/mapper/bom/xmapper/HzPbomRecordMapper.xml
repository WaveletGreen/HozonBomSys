<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="HzPbomRecord">
  <resultMap id="BaseResultMap" type="sql.pojo.bom.HzPbomRecord">
    <id column="P_PUID" jdbcType="VARCHAR" property="puid" />
    <result column="P_ITEM_RESOURCE" jdbcType="VARCHAR" property="itemResource" />
    <result column="P_RESOURCE" jdbcType="VARCHAR" property="resource" />
    <result column="P_TYPE" jdbcType="DECIMAL" property="type" />
    <result column="P_BUY_UNIT" jdbcType="DECIMAL" property="buyUnit" />
    <result column="P_WORK_SHOP1" jdbcType="VARCHAR" property="workShop1" />
    <result column="P_WORK_SHOP2" jdbcType="VARCHAR" property="workShop2" />
    <result column="P_PRODUCT_LINE" jdbcType="VARCHAR" property="productLine" />
    <result column="P_MOULD_TYPE" jdbcType="VARCHAR" property="mouldType" />
    <result column="P_OUTER_PART" jdbcType="VARCHAR" property="outerPart" />
    <result column="P_COLOR_PART" jdbcType="DECIMAL" property="colorPart" />
    <result column="P_E_BOM_PUID" jdbcType="VARCHAR" property="eBomPuid" />
    <result column="P_PBOM_STATUS" jdbcType="DECIMAL" property="pbomStatus" />
    <result column="P_STATION" jdbcType="DECIMAL" property="station" />
  </resultMap>

  <resultMap extends="BaseResultMap"  id="HzPbomLineRecord" type="sql.pojo.bom.HzPbomLineRecord">
    <id column="PUID" jdbcType="VARCHAR" property="pPuid" />
    <result column="P_LINE_INDEX" jdbcType="VARCHAR" property="lineIndex" />
    <result column="P_BOM_LINE_IS_HAS" jdbcType="INTEGER" property="isHas" />
    <result column="P_BOM_LINE_ID" jdbcType="VARCHAR" property="lineId" />
    <result column="P_BOM_LINE_IS_2Y" jdbcType="INTEGER" property="is2Y" />
    <result column="P_BOM_OF_WHICH_DEPT" jdbcType="VARCHAR" property="pBomOfWhichDept" />
    <result column="P_PARENT_UID" jdbcType="VARCHAR" property="parentUid"/>
    <result column="P_BOM_DIGIFAX_ID" jdbcType="VARCHAR" property="bomDigifaxId"/>
    <result column="P_BOM_LINE_PUID" jdbcType="VARCHAR" property="linePuid"/>
    <result column="P_BOM_LINE_IS_PART" jdbcType="INTEGER" property="isPart"/>
    <result column="P_BOM_ORDER_NUM" jdbcType="INTEGER" property="orderNum"/>
    <result column="P_BOM_LINE_IS_DEPT" jdbcType="INTEGER" property="isDept"/>
    <result column="P_BOM_LINE_PART_NAME" jdbcType="VARCHAR" property="pBomLinePartName"/>
    <result column="P_BOM_LINE_PART_CLASS" jdbcType="VARCHAR" property="pBomLinePartClass"/>
    <result column="P_BOM_LINE_BLOCK" jdbcType="BLOB" property="bomLineBlock"/>
  </resultMap>

  <sql id="Pbom_List">
    P_LINE_INDEX,P_BOM_LINE_IS_HAS,P_BOM_LINE_ID,P_BOM_LINE_IS_2Y,P_BOM_OF_WHICH_DEPT
  </sql>


  <sql id="Base_Column_List">
    P_PUID, P_ITEM_RESOURCE, P_RESOURCE, P_TYPE, P_BUY_UNIT, P_WORK_SHOP1, P_WORK_SHOP2, P_PRODUCT_LINE,
    P_MOULD_TYPE, P_OUTER_PART, P_COLOR_PART, P_E_BOM_PUID,P_PBOM_STATUS,P_STATION
  </sql>



  <!--联表查询 EBOM PBOM信息-->
  <select id="HzPbomRecordDAOImpl_getPbomRecord" resultMap="HzPbomLineRecord" parameterType="java.util.HashMap">

    select t.*,t6.* from HZ_BOM_LINE_RECORD t LEFT OUTER JOIN HZ_PBOM_RECORD t6 ON  t.puid = T6.p_E_BOM_PUID
    where t.p_bom_digifax_id=(
    select t3.puid from Hz_Bom_Main_Record t3 where t3.p_cfg0_of_which_project_puid=(
    select t2.puid from Hz_project_libs t2
    <where>
      t2.puid=#{projectId,jdbcType=VARCHAR}))
      <if test="lineId != null and  lineId!='' " >
        and t.P_BOM_LINE_ID = #{lineId,jdbcType=VARCHAR}
      </if>
    </where>
  </select>

  <!--查询PBOM子节点信息-->
  <select id="HzPbomRecordDAOImpl_getHzPbomById" resultMap="HzPbomLineRecord" parameterType="java.util.HashMap">

    select t.*,t6.* from HZ_BOM_LINE_RECORD t LEFT OUTER JOIN HZ_PBOM_RECORD t6 ON  t.puid = T6.p_E_BOM_PUID
    where t.p_bom_digifax_id=(
    select t3.puid from Hz_Bom_Main_Record t3 where t3.p_cfg0_of_which_project_puid=(
    select t2.puid from Hz_project_libs t2
    <where>
        t2.puid = #{projectId,jdbcType=VARCHAR}))
      <if test="parentUid != null and  parentUid!='' " >
        and t.P_PARENT_UID = #{parentUid,jdbcType=VARCHAR}
      </if>
    </where>
  </select>






  <!--模糊搜索的分组号 零件号 暂时没有 模糊匹配后期需要加-->
  <select id="HzPbomRecordDAOImpl_searchPbomLineDetail" parameterType="sql.pojo.bom.HzPbomLineRecord" resultMap="HzPbomLineRecord">
    select
    t1.P_PUID,<include refid="Pbom_List" />,t2.*
    from HZ_BOM_LINE_RECORD t1 LEFT OUTER JOIN HZ_PBOM_RECORD t2
    on t1.P_PUID = t2.P_E_BOM_PUID
  <where>
    1=1
    <if test="pBomOfWhichDept != null and  pBomOfWhichDept!='' " >
      and t1.P_BOM_OF_WHICH_DEPT = #{pBomOfWhichDept,jdbcType=VARCHAR}
    </if>
    <if test="lineID != null and  lineID!=''">
      and t1.P_BOM_LINE_ID = #{lineID,jdbcType=VARCHAR}
    </if>
    <if test="isHas != null">
    and t1.P_BOM_LINE_IS_HAS = #{isHas,jdbcType=INTEGER}
    </if>
    <if test="lineIndex != null and  lineIndex!=''">
      and length(t1.P_LINE_INDEX) = #{lineIndex,jdbcType=VARCHAR}
    </if>
  </where>
  </select>






  <select id="selectByPrimaryKey" parameterType="java.lang.String" resultMap="BaseResultMap">
    select 
    <include refid="Base_Column_List" />
    from HZ_PBOM_RECORD
    where P_PUID = #{puid,jdbcType=VARCHAR}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String">
    delete from HZ_PBOM_RECORD
    where P_PUID = #{puid,jdbcType=VARCHAR}
  </delete>


  <insert id="insert" parameterType="sql.pojo.bom.HzPbomRecord">
    insert into HZ_PBOM_RECORD (P_PUID, P_ITEM_RESOURCE, P_RESOURCE,
      P_TYPE, P_BUY_UNIT, P_WORK_SHOP1,
      P_WORK_SHOP2, P_PRODUCT_LINE, P_MOULD_TYPE,
      P_OUTER_PART, P_COLOR_PART, P_E_BOM_PUID
      )
    values (#{puid,jdbcType=VARCHAR}, #{itemResource,jdbcType=VARCHAR}, #{resource,jdbcType=VARCHAR}, 
      #{type,jdbcType=DECIMAL}, #{buyUnit,jdbcType=DECIMAL}, #{workShop1,jdbcType=VARCHAR}, 
      #{workShop2,jdbcType=VARCHAR}, #{productLine,jdbcType=VARCHAR}, #{mouldType,jdbcType=VARCHAR}, 
      #{outerPart,jdbcType=VARCHAR}, #{colorPart,jdbcType=DECIMAL}, #{eBomPuid,jdbcType=VARCHAR}
      )
  </insert>


  <insert id="HzPbomRecordDAOImpl_insert" parameterType="sql.pojo.bom.HzPbomRecord">
    insert into HZ_PBOM_RECORD
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="puid != null">
        P_PUID,
      </if>
      <if test="itemResource != null">
        P_ITEM_RESOURCE,
      </if>
      <if test="resource != null">
        P_RESOURCE,
      </if>
      <if test="type != null">
        P_TYPE,
      </if>
      <if test="buyUnit != null">
        P_BUY_UNIT,
      </if>
      <if test="workShop1 != null">
        P_WORK_SHOP1,
      </if>
      <if test="workShop2 != null">
        P_WORK_SHOP2,
      </if>
      <if test="productLine != null">
        P_PRODUCT_LINE,
      </if>
      <if test="mouldType != null">
        P_MOULD_TYPE,
      </if>
      <if test="outerPart != null">
        P_OUTER_PART,
      </if>
      <if test="colorPart != null">
        P_COLOR_PART,
      </if>
      <if test="eBomPuid != null">
        P_E_BOM_PUID,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="puid != null">
        #{puid,jdbcType=VARCHAR},
      </if>
      <if test="itemResource != null">
        #{itemResource,jdbcType=VARCHAR},
      </if>
      <if test="resource != null">
        #{resource,jdbcType=VARCHAR},
      </if>
      <if test="type != null">
        #{type,jdbcType=DECIMAL},
      </if>
      <if test="buyUnit != null">
        #{buyUnit,jdbcType=DECIMAL},
      </if>
      <if test="workShop1 != null">
        #{workShop1,jdbcType=VARCHAR},
      </if>
      <if test="workShop2 != null">
        #{workShop2,jdbcType=VARCHAR},
      </if>
      <if test="productLine != null">
        #{productLine,jdbcType=VARCHAR},
      </if>
      <if test="mouldType != null">
        #{mouldType,jdbcType=VARCHAR},
      </if>
      <if test="outerPart != null">
        #{outerPart,jdbcType=VARCHAR},
      </if>
      <if test="colorPart != null">
        #{colorPart,jdbcType=DECIMAL},
      </if>
      <if test="eBomPuid != null">
        #{eBomPuid,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="sql.pojo.bom.HzPbomRecord">
    update HZ_PBOM_RECORD
    <set>
      <if test="itemResource != null">
        P_ITEM_RESOURCE = #{itemResource,jdbcType=VARCHAR},
      </if>
      <if test="resource != null">
        P_RESOURCE = #{resource,jdbcType=VARCHAR},
      </if>
      <if test="type != null">
        P_TYPE = #{type,jdbcType=DECIMAL},
      </if>
      <if test="buyUnit != null">
        P_BUY_UNIT = #{buyUnit,jdbcType=DECIMAL},
      </if>
      <if test="workShop1 != null">
        P_WORK_SHOP1 = #{workShop1,jdbcType=VARCHAR},
      </if>
      <if test="workShop2 != null">
        P_WORK_SHOP2 = #{workShop2,jdbcType=VARCHAR},
      </if>
      <if test="productLine != null">
        P_PRODUCT_LINE = #{productLine,jdbcType=VARCHAR},
      </if>
      <if test="mouldType != null">
        P_MOULD_TYPE = #{mouldType,jdbcType=VARCHAR},
      </if>
      <if test="outerPart != null">
        P_OUTER_PART = #{outerPart,jdbcType=VARCHAR},
      </if>
      <if test="colorPart != null">
        P_COLOR_PART = #{colorPart,jdbcType=DECIMAL},
      </if>
      <if test="eBomPuid != null">
        P_E_BOM_PUID = #{eBomPuid,jdbcType=VARCHAR},
      </if>
    </set>
    where P_PUID = #{puid,jdbcType=VARCHAR}
  </update>
  <update id="updateByPrimaryKey" parameterType="sql.pojo.bom.HzPbomRecord">
    update HZ_PBOM_RECORD
    set P_ITEM_RESOURCE = #{itemResource,jdbcType=VARCHAR},
      P_RESOURCE = #{resource,jdbcType=VARCHAR},
      P_TYPE = #{type,jdbcType=DECIMAL},
      P_BUY_UNIT = #{buyUnit,jdbcType=DECIMAL},
      P_WORK_SHOP1 = #{workShop1,jdbcType=VARCHAR},
      P_WORK_SHOP2 = #{workShop2,jdbcType=VARCHAR},
      P_PRODUCT_LINE = #{productLine,jdbcType=VARCHAR},
      P_MOULD_TYPE = #{mouldType,jdbcType=VARCHAR},
      P_OUTER_PART = #{outerPart,jdbcType=VARCHAR},
      P_COLOR_PART = #{colorPart,jdbcType=DECIMAL},
      P_E_BOM_PUID = #{eBomPuid,jdbcType=VARCHAR}
    where P_PUID = #{puid,jdbcType=VARCHAR}
  </update>
</mapper>