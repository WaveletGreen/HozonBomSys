<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="HzPbomRecordMapper">

  <resultMap id="SingleVehDosageMap"
             type="sql.pojo.bom.HzPbomLineRecord">
    <result column="P_SINGLE_VEH_DOSAGE" jdbcType="BLOB"
            property="singleVehDosage"/>
  </resultMap>

  <resultMap extends="SingleVehDosageMap" id="HzPbomLineRecord" type="sql.pojo.bom.HzPbomLineRecord">
    <id column="PUID" jdbcType="VARCHAR" property="puid" />
    <result column="P_RESOURCE" jdbcType="VARCHAR" property="resource" />
    <result column="P_TYPE" jdbcType="INTEGER" property="type" />
    <result column="P_BUY_UNIT" jdbcType="INTEGER" property="buyUnit" />
    <result column="P_WORK_SHOP1" jdbcType="VARCHAR" property="workShop1" />
    <result column="P_WORK_SHOP2" jdbcType="VARCHAR" property="workShop2" />
    <result column="P_PRODUCT_LINE" jdbcType="VARCHAR" property="productLine" />
    <result column="P_MOULD_TYPE" jdbcType="VARCHAR" property="mouldType" />
    <result column="P_OUTER_PART" jdbcType="VARCHAR" property="outerPart" />
    <result column="P_COLOR_PART" jdbcType="INTEGER" property="colorPart" />
    <result column="P_STATION" jdbcType="VARCHAR" property="station" />
    <result column="P_CREATE_TIME" jdbcType="DATE" property="createTime" />
    <result column="P_UPDATE_TIME" jdbcType="DATE" property="updateTime" />
    <result column="P_CREATE_NAME" jdbcType="VARCHAR" property="createName" />
    <result column="P_UPDATE_NAME" jdbcType="VARCHAR" property="updateName" />
    <result column="P_PBOM_STATUS" jdbcType="INTEGER" property="status" />
    <result column="P_E_BOM_PUID" jdbcType="VARCHAR" property="eBomPuid" />


    <result column="P_PARENT_UID" jdbcType="VARCHAR" property="parentUid" />
    <result column="P_BOM_DIGIFAX_ID" jdbcType="VARCHAR" property="bomDigifaxId" />
    <result column="P_LINE_INDEX" jdbcType="VARCHAR" property="lineIndex" />
    <result column="P_BOM_LINE_IS_HAS" jdbcType="INTEGER" property="isHas" />
    <result column="P_BOM_LINE_PUID" jdbcType="VARCHAR" property="linePuid" />
    <result column="P_BOM_LINE_ID" jdbcType="VARCHAR" property="lineId" />
    <result column="P_BOM_LINE_IS_2Y" jdbcType="INTEGER" property="is2Y" />
    <result column="P_BOM_LINE_IS_PART" jdbcType="INTEGER" property="isPart" />
    <result column="P_BOM_LINE_IS_DEPT" jdbcType="INTEGER" property="isDept" />
    <result column="P_BOM_OF_WHICH_DEPT" jdbcType="VARCHAR" property="pBomOfWhichDept" />
    <result column="P_BOM_LINE_PART_NAME" jdbcType="VARCHAR" property="pBomLinePartName" />
    <result column="P_BOM_LINE_PART_CLASS" jdbcType="VARCHAR" property="pBomLinePartClass" />
    <result column="P_BOM_LINE_PART_EN_NAME" jdbcType="VARCHAR" property="pBomLinePartEnName" />
    <result column="P_BOM_LINE_PART_RESOURCE" jdbcType="VARCHAR" property="pBomLinePartResource" />
    <result column="P_BOM_ORDER_NUM" jdbcType="INTEGER" property="orderNum" />
    <result column="P_LOU_LOA_FLAG" jdbcType="INTEGER" property="pLouaFlag"/>
    <result column="P_SORT_NUM" jdbcType="VARCHAR" property="sortNum" />
    <result column="P_COLOR_PART" jdbcType="INTEGER" property="colorPart" />
    <result column="P_IS_NEW_PART" jdbcType="INTEGER" property="isNewPart" />
  </resultMap>

  <sql id="Pbom_List">
     PUID, P_RESOURCE, P_COLOR_PART, P_E_BOM_PUID, P_PBOM_STATUS, P_TYPE, P_BUY_UNIT,
    P_WORK_SHOP1, P_WORK_SHOP2, P_PRODUCT_LINE, P_MOULD_TYPE, P_OUTER_PART, P_CREATE_TIME,
    P_UPDATE_TIME, P_CREATE_NAME, P_UPDATE_NAME, P_STATION, P_PARENT_UID, P_BOM_DIGIFAX_ID,
    P_LINE_INDEX, P_BOM_LINE_IS_HAS, P_BOM_LINE_PUID, P_BOM_LINE_ID, P_BOM_LINE_IS_2Y,
    P_BOM_LINE_IS_PART, P_BOM_LINE_IS_DEPT, P_BOM_OF_WHICH_DEPT, P_BOM_LINE_PART_NAME,
    P_BOM_LINE_PART_CLASS, P_BOM_LINE_PART_EN_NAME, P_BOM_LINE_PART_RESOURCE,P_BOM_ORDER_NUM,P_SORT_NUM,
    P_COLOR_PART,P_IS_NEW_PART
  </sql>


  <sql id="Base_Column_List">
    PUID, P_STATION, P_RESOURCE, P_TYPE, P_BUY_UNIT, P_WORK_SHOP1, P_WORK_SHOP2, P_PRODUCT_LINE,
    P_MOULD_TYPE, P_OUTER_PART, P_COLOR_PART, P_E_BOM_PUID,P_PBOM_STATUS,P_CREATE_TIME,P_UPDATE_TIME
    P_CREATE_NAME,P_UPDATE_NAME,P_PBOM_STATUS,P_BOM_ORDER_NUM,P_SORT_NUM,P_COLOR_PART
  </sql>

  <!--联表查询  PBOM信息-->
  <select id="HzPbomRecordDAOImpl_getPbomRecord" resultMap="HzPbomLineRecord" parameterType="java.util.HashMap">
    select  t.*
    from HZ_PBOM_RECORD t
    where t.p_bom_digifax_id=(
    select t3.puid from Hz_Bom_Main_Record t3 where t3.p_cfg0_of_which_project_puid=(
    select t2.puid from Hz_project_libs t2
    <where>
      t2.puid=#{projectId,jdbcType=VARCHAR}))
      <if test="lineIndex != null and lineIndex!=''">
        and LENGTH(TRANSLATE(t.P_LINE_INDEX,',0123456789','.'))=#{lineIndex,jdbcType=VARCHAR}
      </if>
      <if test="isHas != null and isHas==0">
        and (t.P_BOM_LINE_IS_HAS = 0)
      </if>
      <if test="isHas != null and isHas==1">
        and t.P_BOM_LINE_IS_HAS = 1
      </if>
      <if test="lineId != null and lineId!=''" >
        and t.P_BOM_LINE_ID like CONCAT(CONCAT('%',#{lineId,jdbcType=VARCHAR}),'%')
      </if>
      <if test="pBomOfWhichDept != null and  pBomOfWhichDept!='' " >
        and t.P_BOM_OF_WHICH_DEPT like CONCAT(CONCAT('%',#{pBomOfWhichDept,jdbcType=VARCHAR}),'%')
      </if>
        <if test="pBomLinePartClass != null and pBomLinePartClass!=''">
            and t.P_BOM_LINE_PART_CLASS = #{pBomLinePartClass,jdbcType=VARCHAR}
        </if>
        <if test="pBomLinePartResource != null and pBomLinePartResource!=''">
            and t.P_BOM_LINE_PART_RESOURCE = #{pBomLinePartResource,jdbcType=VARCHAR}
        </if>
        and t.P_PBOM_STATUS<![CDATA[ <> ]]>0 order by CAST(t.P_SORT_NUM as FLOAT)
    </where>
  </select>


  <!--联表查询PBOM 总数-->
  <select id="HzPbomRecordDAOImpl_getTotalCount" resultType="java.lang.Integer" parameterType="java.util.HashMap">
    select  count(*)
    from HZ_PBOM_RECORD t
    where t.p_bom_digifax_id=(
    select t3.puid from Hz_Bom_Main_Record t3 where t3.p_cfg0_of_which_project_puid=(
    select t2.puid from Hz_project_libs t2
    <where>
      t2.puid=#{projectId,jdbcType=VARCHAR}))
      <if test="lineIndex != null and lineIndex!=''">
        and LENGTH(TRANSLATE(t.P_LINE_INDEX,',0123456789','.'))=#{lineIndex,jdbcType=VARCHAR}
      </if>
      <if test="isHas != null and isHas==0">
        and (t.P_BOM_LINE_IS_HAS = 0)
      </if>
      <if test="isHas != null and isHas==1">
        and t.P_BOM_LINE_IS_HAS = 1
      </if>
      <if test="lineId != null and lineId!=''" >
        and t.P_BOM_LINE_ID like CONCAT(CONCAT('%',#{lineId,jdbcType=VARCHAR}),'%')
      </if>
      <if test="pBomOfWhichDept != null and  pBomOfWhichDept!='' " >
        and t.P_BOM_OF_WHICH_DEPT like CONCAT(CONCAT('%',#{pBomOfWhichDept,jdbcType=VARCHAR}),'%')
      </if>
        <if test="pBomLinePartClass != null and pBomLinePartClass!=''">
            and P_BOM_LINE_PART_CLASS = #{pBomLinePartClass,jdbcType=VARCHAR}
        </if>
        <if test="pBomLinePartResource != null and pBomLinePartResource!=''">
            and P_BOM_LINE_PART_RESOURCE = #{pBomLinePartResource,jdbcType=VARCHAR}
        </if>
        and t.P_PBOM_STATUS<![CDATA[ <> ]]>0
    </where>
  </select>


  <!--查询PBOM子层信息-->
  <select id="HzPbomRecordDAOImpl_getHzPbomById" resultMap="HzPbomLineRecord" parameterType="java.util.HashMap">

    select t.* from HZ_PBOM_RECORD t
    where t.p_bom_digifax_id=(
    select t3.puid from Hz_Bom_Main_Record t3 where t3.p_cfg0_of_which_project_puid=(
    select t2.puid from Hz_project_libs t2
    <where>
      1=1
      <if test="projectId != null and  projectId!='' " >
         and t2.puid = #{projectId,jdbcType=VARCHAR}))
      </if>
      <if test="parentUid != null and  parentUid!='' " >
        and t.P_PARENT_UID = #{parentUid,jdbcType=VARCHAR}
      </if>
      and t.P_PBOM_STATUS=1
    </where>
  </select>

  <!--查询根据父层零件ID找父层puid-->
  <select id="HzPbomRecordDAOImpl_getPbomByItemId" resultMap="HzPbomLineRecord" parameterType="java.util.HashMap">
    select t6.* from  HZ_PBOM_RECORD t6
    where t6.p_bom_digifax_id=(
    select t3.puid from Hz_Bom_Main_Record t3 where t3.p_cfg0_of_which_project_puid=(
    select t2.puid from Hz_project_libs t2
    <where>
      t2.puid=#{projectId,jdbcType=VARCHAR}))
      and t6.P_BOM_LINE_ID = #{puid,jdbcType=VARCHAR}
      and t6.P_PBOM_STATUS <![CDATA[ <> ]]>0
    </where>
  </select>

  <!--获取一条PBOM信息-->
  <select id="HzPbomRecordDAOImpl_getPbomById" resultMap="HzPbomLineRecord" parameterType="java.util.HashMap">

    select t6.* from  HZ_PBOM_RECORD t6
    where t6.p_bom_digifax_id=(
    select t3.puid from Hz_Bom_Main_Record t3 where t3.p_cfg0_of_which_project_puid=(
    select t2.puid from Hz_project_libs t2
    <where>
      1=1
      <if test="projectId != null and  projectId!='' " >
        and t2.puid = #{projectId,jdbcType=VARCHAR}))
      </if>
      <if test="lineId != null and  lineId!='' " >
        and t6.P_BOM_LINE_ID = #{lineId,jdbcType=VARCHAR}
      </if>
      <if test="pPuid != null and  pPuid!='' " >
        and t6.P_E_BOM_PUID = #{pPuid,jdbcType=VARCHAR}
      </if>
      <if test="status != null  " >
        and t6.P_PBOM_STATUS= #{status,jdbcType=INTEGER}
      </if>
      <if test="status == null " >
        and t6.P_PBOM_STATUS<![CDATA[ <> ]]>0
      </if>
    </where>
  </select>


  <!--批量插入-->
  <insert id="HzPbomRecordDAOImpl_insertList" useGeneratedKeys="false" parameterType="java.util.List">
    insert into HZ_PBOM_RECORD (PUID,P_RESOURCE, P_COLOR_PART,P_TYPE,
    P_BUY_UNIT, P_WORK_SHOP1, P_WORK_SHOP2,
    P_PRODUCT_LINE, P_MOULD_TYPE, P_OUTER_PART,
    P_CREATE_TIME, P_UPDATE_TIME, P_CREATE_NAME,
    P_UPDATE_NAME, P_STATION,P_PARENT_UID,P_BOM_DIGIFAX_ID,P_E_BOM_PUID,
    P_LINE_INDEX,P_BOM_LINE_IS_HAS,P_BOM_LINE_PUID,P_BOM_LINE_ID,P_BOM_LINE_IS_2Y,
    P_BOM_LINE_IS_PART,P_BOM_LINE_IS_DEPT,P_BOM_OF_WHICH_DEPT,P_BOM_LINE_PART_NAME,
    P_BOM_LINE_PART_CLASS,P_BOM_LINE_PART_EN_NAME,P_BOM_LINE_PART_RESOURCE,P_SORT_NUM,P_PBOM_STATUS,P_IS_NEW_PART,
    P_SINGLE_VEH_DOSAGE
    )
    <foreach collection="list" item="item" index="index" separator="UNION ALL">
      select
      #{item.puid,jdbcType=VARCHAR},#{item.resource,jdbcType=VARCHAR}, #{item.colorPart,jdbcType=INTEGER},
      #{item.type,jdbcType=INTEGER},#{item.buyUnit,jdbcType=INTEGER}, #{item.workShop1,jdbcType=VARCHAR},
      #{item.workShop2,jdbcType=VARCHAR},#{item.productLine,jdbcType=VARCHAR}, #{item.mouldType,jdbcType=VARCHAR},
      #{item.outerPart,jdbcType=VARCHAR},sysdate, sysdate, #{item.createName,jdbcType=VARCHAR},
      #{item.updateName,jdbcType=VARCHAR}, #{item.station,jdbcType=VARCHAR},#{item.parentUid,jdbcType=VARCHAR},
      #{item.bomDigifaxId,jdbcType=VARCHAR},#{item.eBomPuid,jdbcType=VARCHAR},#{item.lineIndex,jdbcType=VARCHAR},
      #{item.isHas,jdbcType=INTEGER},#{item.linePuid,jdbcType=VARCHAR}, #{item.lineId,jdbcType=VARCHAR}, #{item.is2Y,jdbcType=INTEGER},
      #{item.isPart,jdbcType=INTEGER}, #{item.isDept,jdbcType=INTEGER}, #{item.pBomOfWhichDept,jdbcType=VARCHAR},
      #{item.pBomLinePartName,jdbcType=VARCHAR}, #{item.pBomLinePartClass,jdbcType=VARCHAR}, #{item.pBomLinePartEnName,jdbcType=VARCHAR},
      #{item.pBomLinePartResource,jdbcType=VARCHAR},#{item.sortNum,jdbcType=VARCHAR},1,#{item.isNewPart,jdbcType=INTEGER},
      #{item.singleVehDosage,jdbcType=VARCHAR}
      from DUAL
    </foreach>
  </insert>


  <!--获取一条 PBOM记录-->
  <select id="HzPbomRecordDAOImpl_getHzPbomByEbomPuid" resultMap="HzPbomLineRecord" parameterType="java.util.HashMap">

    SELECT * FROM HZ_PBOM_RECORD
    where  p_bom_digifax_id=(
    select t3.puid from Hz_Bom_Main_Record t3 where t3.p_cfg0_of_which_project_puid=(
    select t2.puid from Hz_project_libs t2
    <where>
    1=1
    <if test="projectId != null and  projectId!='' " >
      and t2.puid = #{projectId,jdbcType=VARCHAR}))
    </if>
    <if test="eBomPuid != null and  eBomPuid!='' " >
      and P_E_BOM_PUID = #{eBomPuid,jdbcType=VARCHAR}
    </if>
     and P_PBOM_STATUS<![CDATA[ <> ]]>0
    </where>
  </select>

  <insert id="HzPbomRecordDAOImpl_insert2" parameterType="sql.pojo.bom.HzPbomLineRecord">
      insert into HZ_PBOM_RECORD(
      PUID,P_RESOURCE,P_TYPE,P_BUY_UNIT, P_WORK_SHOP1, P_WORK_SHOP2,P_PRODUCT_LINE,
      P_MOULD_TYPE, P_OUTER_PART,P_COLOR_PART,P_STATION,P_CREATE_TIME, P_UPDATE_TIME,
      P_CREATE_NAME,P_UPDATE_NAME, P_PBOM_STATUS, P_E_BOM_PUID, P_PARENT_UID, P_BOM_DIGIFAX_ID,
      P_LINE_INDEX,P_BOM_LINE_IS_HAS, P_BOM_LINE_PUID, P_BOM_LINE_ID, P_BOM_LINE_IS_2Y,
      P_BOM_LINE_IS_PART,P_BOM_LINE_IS_DEPT, P_BOM_OF_WHICH_DEPT, P_BOM_LINE_PART_NAME,
      P_BOM_LINE_PART_CLASS,P_BOM_LINE_PART_EN_NAME, P_BOM_LINE_PART_RESOURCE,
      P_BOM_ORDER_NUM,P_LOU_LOA_FLAG,P_SORT_NUM,P_IS_NEW_PART

      )values (
      #{puid,jdbcType=VARCHAR},#{resource,jdbcType=VARCHAR},#{type,jdbcType=INTEGER},
      #{buyUnit,jdbcType=INTEGER},#{workShop1,jdbcType=VARCHAR},#{workShop2,jdbcType=VARCHAR},
      #{productLine,jdbcType=VARCHAR},#{mouldType,jdbcType=VARCHAR},#{outerPart,jdbcType=VARCHAR},
      #{colorPart,jdbcType=INTEGER},#{station,jdbcType=VARCHAR},#{createTime,jdbcType=DATE},
      #{updateTime,jdbcType=DATE},#{createName,jdbcType=VARCHAR},#{updateName,jdbcType=VARCHAR},
      #{status,jdbcType=INTEGER},#{eBomPuid,jdbcType=VARCHAR},#{parentUid,jdbcType=VARCHAR},
      #{bomDigifaxId,jdbcType=VARCHAR},#{lineIndex,jdbcType=VARCHAR},#{isHas,jdbcType=INTEGER},
      #{linePuid,jdbcType=VARCHAR},#{lineId,jdbcType=VARCHAR},#{is2Y,jdbcType=INTEGER},
      #{isPart,jdbcType=INTEGER},#{isDept,jdbcType=INTEGER},#{pBomOfWhichDept,jdbcType=VARCHAR},
      #{pBomLinePartName,jdbcType=VARCHAR},#{pBomLinePartClass,jdbcType=VARCHAR},#{pBomLinePartEnName,jdbcType=VARCHAR},
      #{pBomLinePartResource,jdbcType=VARCHAR},#{orderNum,jdbcType=INTEGER},#{pLouaFlag,jdbcType=INTEGER},
      #{sortNum,jdbcType=VARCHAR},#{isNewPart,jdbcType=INTEGER}
      )
  </insert>

  <!--根据零件号查询pbom-->
  <select id="HzPbomRecordDAOImpl_findPbom" resultMap="HzPbomLineRecord" parameterType="java.util.HashMap">
    SELECT t1.* from HZ_PBOM_RECORD t1
    where t1.p_bom_digifax_id=(
    select t3.puid from Hz_Bom_Main_Record t3 where t3.p_cfg0_of_which_project_puid=(
    select t2.puid from Hz_project_libs t2
    <where>
      t2.puid=#{projectId,jdbcType=VARCHAR}))
      <if test="eBomPuid != null and  eBomPuid!='' " >
        and t1.P_E_BOM_PUID = #{eBomPuid,jdbcType=VARCHAR}
      </if>
      <if test="lineId != null and lineId!=''">
        and t1.P_BOM_LINE_ID = #{lineId,jdbcType=VARCHAR}
      </if>
      <if test="parentId != null and parentId!=''">
        and t1.P_PARENT_UID = #{parentId,jdbcType=VARCHAR}
      </if>
      and t1.P_PBOM_STATUS <![CDATA[ <> ]]>0
      order by CAST(t1.P_SORT_NUM as FLOAT)
    </where>
  </select>



  <!--查询油漆车身总成和白车身总成-->
  <select id="HzPbomRecordDAOImpl_getPaintAndWhiteBody" parameterType="java.util.HashMap" resultMap="HzPbomLineRecord">
    SELECT t1.* from HZ_PBOM_RECORD t1
    where t1.p_bom_digifax_id=(
    select t3.puid from Hz_Bom_Main_Record t3 where t3.p_cfg0_of_which_project_puid=(
    select t2.puid from Hz_project_libs t2
    <where>
      t2.puid=#{projectId,jdbcType=VARCHAR}))
      and (t1.P_BOM_LINE_PART_NAME like '白车身总成%'
      or t1.P_BOM_LINE_PART_NAME like '油漆车身总成%')
    </where>
    start with t1.P_E_BOM_PUID = #{puid,jdbcType=VARCHAR} and t1.P_PBOM_STATUS<![CDATA[ <> ]]>0
    connect by prior t1.P_E_BOM_PUID = t1.p_parent_uid  and t1.P_PBOM_STATUS<![CDATA[ <> ]]>0
    order by CAST(t1.P_SORT_NUM as FLOAT)
  </select>


  <!--获取除变形外的相同的零件号-->
  <select id="HzPbomRecordDAOImpl_getSameNameLineId" parameterType="java.util.HashMap" resultMap="HzPbomLineRecord">
    select * from HZ_PBOM_RECORD t1
    where t1.p_bom_digifax_id=(
    select t3.puid from Hz_Bom_Main_Record t3 where t3.p_cfg0_of_which_project_puid=(
    select t2.puid from Hz_project_libs t2
    <where>
      t2.puid=#{projectId,jdbcType=VARCHAR}))
      <if test="lineId != null and lineId!=''" >
        and t1.P_BOM_LINE_ID like CONCAT(CONCAT('%',#{lineId,jdbcType=VARCHAR}),'%')
      </if>
    </where>
  </select>


  <!--插入单条-->
  <insert id="HzPbomRecordDAOImpl_insert" parameterType="sql.pojo.bom.HzPbomLineRecord">
    insert into HZ_PBOM_RECORD (PUID, P_RESOURCE, P_COLOR_PART,
      P_E_BOM_PUID, P_PBOM_STATUS, P_TYPE,
      P_BUY_UNIT, P_WORK_SHOP1, P_WORK_SHOP2,
      P_PRODUCT_LINE, P_MOULD_TYPE, P_OUTER_PART,
      P_CREATE_TIME, P_UPDATE_TIME, P_CREATE_NAME,
      P_UPDATE_NAME, P_STATION, P_PARENT_UID,
      P_BOM_DIGIFAX_ID, P_LINE_INDEX, P_BOM_LINE_IS_HAS,
      P_BOM_LINE_PUID, P_BOM_LINE_ID, P_BOM_LINE_IS_2Y,
      P_BOM_LINE_IS_PART, P_BOM_LINE_IS_DEPT, P_BOM_OF_WHICH_DEPT,
      P_BOM_LINE_PART_NAME, P_BOM_LINE_PART_CLASS, P_BOM_LINE_PART_EN_NAME,
      P_BOM_LINE_PART_RESOURCE,
      P_LOU_LOA_FLAG, P_SORT_NUM, P_IS_NEW_PART
      )
    values (#{puid,jdbcType=VARCHAR}, #{resource,jdbcType=VARCHAR}, #{colorPart,jdbcType=INTEGER},
      #{eBomPuid,jdbcType=VARCHAR}, #{status,jdbcType=INTEGER}, #{type,jdbcType=INTEGER},
      #{buyUnit,jdbcType=INTEGER}, #{workShop1,jdbcType=VARCHAR}, #{workShop2,jdbcType=VARCHAR},
      #{productLine,jdbcType=VARCHAR}, #{mouldType,jdbcType=VARCHAR}, #{outerPart,jdbcType=VARCHAR},
      sysdate,sysdate, #{createName,jdbcType=VARCHAR},
      #{updateName,jdbcType=VARCHAR}, #{station,jdbcType=VARCHAR}, #{parentUid,jdbcType=VARCHAR},
      #{bomDigifaxId,jdbcType=VARCHAR}, #{lineIndex,jdbcType=VARCHAR}, #{isHas,jdbcType=INTEGER},
      #{linePuid,jdbcType=VARCHAR}, #{lineId,jdbcType=VARCHAR}, #{is2Y,jdbcType=INTEGER},
      #{isPart,jdbcType=INTEGER}, #{isDept,jdbcType=INTEGER}, #{pBomOfWhichDept,jdbcType=VARCHAR},
      #{pBomLinePartName,jdbcType=VARCHAR}, #{pBomLinePartClass,jdbcType=VARCHAR}, #{pBomLinePartEnName,jdbcType=VARCHAR},
      #{pBomLinePartResource,jdbcType=VARCHAR},
      #{pLouaFlag,jdbcType=INTEGER}, #{sortNum,jdbcType=VARCHAR}, #{isNewPart,jdbcType=INTEGER}
      )
  </insert>

  <!--导入更新-->
  <update id="HzPbomRecordDAOImpl_updateInput" parameterType="sql.pojo.bom.HzPbomLineRecord">
    update HZ_PBOM_RECORD
    <set>
      <if test="resource != null">
        P_RESOURCE = #{resource,jdbcType=VARCHAR},
      </if>
      <if test="type != null">
        P_TYPE = #{type,jdbcType=INTEGER},
      </if>
      <if test="buyUnit != null">
        P_BUY_UNIT = #{buyUnit,jdbcType=INTEGER},
      </if>
      <if test="workShop1 != null">
        P_WORK_SHOP1 = #{workShop1,jdbcType=VARCHAR},
      </if>
      <if test="workShop2 != null">
        P_WORK_SHOP2 = #{workShop2,jdbcType=VARCHAR},
      </if>
      <if test="productLine != null">
        P_PRODUCT_LINE = #{productLine,jdbcType=VARCHAR},
      </if>
      <if test="mouldType != null">
        P_MOULD_TYPE = #{mouldType,jdbcType=VARCHAR},
      </if>
      <if test="outerPart != null">
        P_OUTER_PART = #{outerPart,jdbcType=VARCHAR},
      </if>
      <if test="station != null">
        P_STATION = #{station,jdbcType=VARCHAR},
      </if>
    </set>
    where P_BOM_LINE_ID = #{lineId,jdbcType=VARCHAR}
    and P_BOM_DIGIFAX_ID = #{bomDigifaxId,jdbcType=VARCHAR}
    and P_PBOM_STATUS <![CDATA[ <> ]]>0
  </update>

  <!--更新-->
  <update id="HzPbomRecordDAOImpl_update" parameterType="sql.pojo.bom.HzPbomLineRecord">
    update HZ_PBOM_RECORD
    <set>
      <if test="resource != null">
        P_RESOURCE = #{resource,jdbcType=VARCHAR},
      </if>
      <if test="colorPart != null">
        P_COLOR_PART = #{colorPart,jdbcType=INTEGER},
      </if>
      <if test="type != null">
        P_TYPE = #{type,jdbcType=INTEGER},
      </if>
      <if test="buyUnit != null">
        P_BUY_UNIT = #{buyUnit,jdbcType=INTEGER},
      </if>
      <if test="workShop1 != null">
        P_WORK_SHOP1 = #{workShop1,jdbcType=VARCHAR},
      </if>
      <if test="workShop2 != null">
        P_WORK_SHOP2 = #{workShop2,jdbcType=VARCHAR},
      </if>
      <if test="productLine != null">
        P_PRODUCT_LINE = #{productLine,jdbcType=VARCHAR},
      </if>
      <if test="mouldType != null">
        P_MOULD_TYPE = #{mouldType,jdbcType=VARCHAR},
      </if>
      <if test="outerPart != null">
        P_OUTER_PART = #{outerPart,jdbcType=VARCHAR},
      </if>

        P_UPDATE_TIME =sysdate,

      <if test="updateName != null">
        P_UPDATE_NAME = #{updateName,jdbcType=VARCHAR},
      </if>
      <if test="station != null">
        P_STATION = #{station,jdbcType=VARCHAR},
      </if>
      <if test="parentUid != null">
        P_PARENT_UID = #{parentUid,jdbcType=VARCHAR},
      </if>
      <if test="bomDigifaxId != null">
        P_BOM_DIGIFAX_ID = #{bomDigifaxId,jdbcType=VARCHAR},
      </if>
      <if test="lineIndex != null">
        P_LINE_INDEX = #{lineIndex,jdbcType=VARCHAR},
      </if>
      <if test="isHas != null">
        P_BOM_LINE_IS_HAS = #{isHas,jdbcType=INTEGER},
      </if>

      <if test="lineId != null">
        P_BOM_LINE_ID = #{lineId,jdbcType=VARCHAR},
      </if>
      <if test="is2Y != null">
        P_BOM_LINE_IS_2Y = #{is2Y,jdbcType=INTEGER},
      </if>
      <if test="isPart != null">
        P_BOM_LINE_IS_PART = #{isPart,jdbcType=INTEGER},
      </if>
      <if test="isDept != null">
        P_BOM_LINE_IS_DEPT = #{isDept,jdbcType=INTEGER},
      </if>
      <if test="pBomOfWhichDept != null">
        P_BOM_OF_WHICH_DEPT = #{pBomOfWhichDept,jdbcType=VARCHAR},
      </if>
      <if test="pBomLinePartName != null">
        P_BOM_LINE_PART_NAME = #{pBomLinePartName,jdbcType=VARCHAR},
      </if>
      <if test="pBomLinePartClass != null">
        P_BOM_LINE_PART_CLASS = #{pBomLinePartClass,jdbcType=VARCHAR},
      </if>
      <if test="pBomLinePartEnName != null">
        P_BOM_LINE_PART_EN_NAME = #{pBomLinePartEnName,jdbcType=VARCHAR},
      </if>
      <if test="pBomLinePartResource != null">
        P_BOM_LINE_PART_RESOURCE = #{pBomLinePartResource,jdbcType=VARCHAR},
      </if>
      <if test="pLouaFlag != null">
        P_LOU_LOA_FLAG = #{pLouaFlag,jdbcType=INTEGER},
      </if>
      <if test="singleVehDosage != null">
        P_SINGLE_VEH_DOSAGE = #{singleVehDosage,jdbcType=VARCHAR}
      </if>
    </set>
    where P_E_BOM_PUID = #{eBomPuid,jdbcType=VARCHAR}
    and P_PBOM_STATUS <![CDATA[ <> ]]>0
  </update>



  <!--批量更新-->
  <update id="HzPbomRecordDAOImpl_updateList" parameterType="java.util.List">
    <foreach collection="list" item="item" index="index" open="begin" close=";end;" separator=";">
      update HZ_PBOM_RECORD
      <set>
        <if test="item.resource != null">
          P_RESOURCE = #{item.resource,jdbcType=VARCHAR},
        </if>
        <if test="item.colorPart != null">
          P_COLOR_PART = #{item.colorPart,jdbcType=INTEGER},
        </if>
        <if test="item.type != null">
          P_TYPE = #{item.type,jdbcType=INTEGER},
        </if>
        <if test="item.buyUnit != null">
          P_BUY_UNIT = #{item.buyUnit,jdbcType=INTEGER},
        </if>
        <if test="item.workShop1 != null">
          P_WORK_SHOP1 = #{item.workShop1,jdbcType=VARCHAR},
        </if>
        <if test="item.workShop2 != null">
          P_WORK_SHOP2 = #{item.workShop2,jdbcType=VARCHAR},
        </if>
        <if test="item.productLine != null">
          P_PRODUCT_LINE = #{item.productLine,jdbcType=VARCHAR},
        </if>
        <if test="item.mouldType != null">
          P_MOULD_TYPE = #{item.mouldType,jdbcType=VARCHAR},
        </if>
        <if test="item.outerPart != null">
          P_OUTER_PART = #{item.outerPart,jdbcType=VARCHAR},
        </if>
        P_UPDATE_TIME =sysdate,
        <if test="item.updateName != null">
          P_UPDATE_NAME = #{item.updateName,jdbcType=VARCHAR},
        </if>
        <if test="item.station != null">
          P_STATION = #{item.station,jdbcType=VARCHAR},
        </if>
        <if test="item.parentUid != null">
          P_PARENT_UID = #{item.parentUid,jdbcType=VARCHAR},
        </if>
        <if test="item.bomDigifaxId != null">
          P_BOM_DIGIFAX_ID = #{item.bomDigifaxId,jdbcType=VARCHAR},
        </if>
        <if test="item.lineIndex != null">
          P_LINE_INDEX = #{item.lineIndex,jdbcType=VARCHAR},
        </if>
        <if test="item.isHas != null">
          P_BOM_LINE_IS_HAS = #{item.isHas,jdbcType=INTEGER},
        </if>
        <if test="item.lineId != null">
          P_BOM_LINE_ID = #{item.lineId,jdbcType=VARCHAR},
        </if>
        <if test="item.is2Y != null">
          P_BOM_LINE_IS_2Y = #{item.is2Y,jdbcType=INTEGER},
        </if>
        <if test="item.isPart != null">
          P_BOM_LINE_IS_PART = #{item.isPart,jdbcType=INTEGER},
        </if>
        <if test="item.isDept != null">
          P_BOM_LINE_IS_DEPT = #{item.isDept,jdbcType=INTEGER},
        </if>
        <if test="item.pBomOfWhichDept != null">
          P_BOM_OF_WHICH_DEPT = #{item.pBomOfWhichDept,jdbcType=VARCHAR},
        </if>
        <if test="item.pBomLinePartName != null">
          P_BOM_LINE_PART_NAME = #{item.pBomLinePartName,jdbcType=VARCHAR},
        </if>
        <if test="item.pBomLinePartClass != null">
          P_BOM_LINE_PART_CLASS = #{item.pBomLinePartClass,jdbcType=VARCHAR},
        </if>
        <if test="item.pBomLinePartEnName != null">
          P_BOM_LINE_PART_EN_NAME = #{item.pBomLinePartEnName,jdbcType=VARCHAR},
        </if>
        <if test="item.pBomLinePartResource != null">
          P_BOM_LINE_PART_RESOURCE = #{item.pBomLinePartResource,jdbcType=VARCHAR},
        </if>
        <if test="item.pLouaFlag != null">
          P_LOU_LOA_FLAG = #{item.pLouaFlag,jdbcType=INTEGER},
        </if>
        <if test="item.singleVehDosage != null">
          P_SINGLE_VEH_DOSAGE = #{item.singleVehDosage,jdbcType=VARCHAR}
        </if>
      </set>
      where P_E_BOM_PUID = #{item.eBomPuid,jdbcType=VARCHAR}
      and P_PBOM_STATUS <![CDATA[ <> ]]>0
    </foreach>
  </update>

<!--恢复一条记录-->
  <update id="HzPbomRecordDAOImpl_recoverBomById" parameterType="java.lang.String">
    update HZ_PBOM_RECORD
    set P_PBOM_STATUS = 1
    where P_E_BOM_PUID = #{eBomPuid,jdbcType=VARCHAR}
 </update>

  <!--查询最大排序号-->
  <select id="HzPbomRecordDAOImpl_findMaxOrderNum" resultType="java.lang.String">
    SELECT * FROM (
        SELECT t1.P_SORT_NUM from HZ_PBOM_RECORD t1
         where t1.P_BOM_DIGIFAX_ID =(
        select t2.puid from Hz_Bom_Main_Record t2
        where
        t2.p_cfg0_of_which_project_puid=#{projectId,jdbcType=VARCHAR}
        )order by CAST(t1.P_SORT_NUM as FLOAT) DESC)WHERE rownum = 1
 </select>

    <!--获取PBOM结构树-->
<select id="HzPbomRecordDAOImpl_getHzPbomTree" parameterType="java.util.HashMap" resultMap="HzPbomLineRecord">
    select * from HZ_PBOM_RECORD t
    where t.p_bom_digifax_id=(
    select t3.puid from Hz_Bom_Main_Record t3 where t3.p_cfg0_of_which_project_puid=(
    select t2.puid from Hz_project_libs t2
    <where>
      t2.puid = #{projectId,jdbcType=VARCHAR}))
    </where>
    start with t.P_E_BOM_PUID = #{puid,jdbcType=VARCHAR} and t.P_PBOM_STATUS <![CDATA[ <> ]]>0
    <if test="colorPart != null">
      and t.P_COLOR_PART = #{colorPart,jdbcType=INTEGER}
    </if>
    connect by prior t.P_E_BOM_PUID = t.p_parent_uid and t.P_PBOM_STATUS<![CDATA[ <> ]]>0
    <if test="colorPart != null">
      and t.P_COLOR_PART = #{colorPart,jdbcType=INTEGER}
    </if>
    order by CAST(t.P_SORT_NUM as FLOAT)
</select>



  <!--分页获取PBOM结构树-->
  <select id="HzPbomRecordDAOImpl_getHzPbomTreeByPage" parameterType="java.util.HashMap" resultMap="HzPbomLineRecord">
    <if test="eBomPuids != null and eBomPuids.size()>0">
      select * from(
      select u.*,rownum as rn from (
      <foreach collection="eBomPuids" index="index" item="item" separator="union all">
        select * from
        (
        select * from HZ_PBOM_RECORD t
        where t.p_bom_digifax_id=(
        select t3.puid from Hz_Bom_Main_Record t3 where t3.p_cfg0_of_which_project_puid=(
        select t2.puid from Hz_project_libs t2
        <where>
          t2.puid = #{projectId,jdbcType=VARCHAR}))
        </where>
        start with t.P_E_BOM_PUID = #{eBomPuids[${index}]}
        and t.P_PBOM_STATUS <![CDATA[ <> ]]>0
        connect by nocycle prior t.P_E_BOM_PUID = t.p_parent_uid
        and t.P_PBOM_STATUS<![CDATA[ <> ]]>0
        order by CAST(t.P_SORT_NUM as FLOAT)
        )
      </foreach>
      ) u
      where  ROWNUM &lt;=#{limit,jdbcType=INTEGER})
      where  rn &gt;#{offset,jdbcType=INTEGER}
    </if>

  </select>


  <!--分页获取PBOM结构树总数-->
  <select id="HzPbomRecordDAOImpl_getHzPbomTreeTotalCount" parameterType="java.util.HashMap" resultType="java.lang.Integer">
    <if test="eBomPuids != null and eBomPuids.size()>0">
      select sum(c) from
      (
      <foreach collection="eBomPuids" index="index" item="item" separator="union all">
        select count(*) c
        from HZ_PBOM_RECORD t
        where t.p_bom_digifax_id=(
        select t3.puid from Hz_Bom_Main_Record t3 where t3.p_cfg0_of_which_project_puid=(
        select t2.puid from Hz_project_libs t2
        <where>
          t2.puid = #{projectId,jdbcType=VARCHAR}))
        </where>
        start with t.P_E_BOM_PUID = #{eBomPuids[${index}]}
        and t.P_PBOM_STATUS <![CDATA[ <> ]]>0
        connect by nocycle prior t.P_E_BOM_PUID = t.p_parent_uid
        and t.P_PBOM_STATUS<![CDATA[ <> ]]>0
      </foreach>
      )
    </if>

  </select>



  <!--获取PBOM 2Y层 对应的lineIndex的第一个字母最大值-->
  <select id="HzPbomRecordDAOImpl_getMaxLineIndexFirstNum" parameterType="java.lang.String" resultType="java.lang.Integer">
    select max(TO_NUMBER((substr(P_LINE_INDEX,instr(P_LINE_INDEX,'.',0),instr(P_LINE_INDEX,'.',1)-1)))) m
    from HZ_PBOM_RECORD t
    where t.p_bom_digifax_id=(
    select t3.puid from Hz_Bom_Main_Record t3 where t3.p_cfg0_of_which_project_puid=(
    select t2.puid from Hz_project_libs t2
    <where>
      t2.puid = #{projectId,jdbcType=VARCHAR}))
      and LENGTH(TRANSLATE(P_LINE_INDEX,',0123456789','.'))=1
    </where>
  </select>


  <!-- 查找重名 -->
  <select id="HzPbomRecordDAOImpl_checkItemIdIsRepeat" parameterType="map" resultType="int">
    SELECT count(*) from HZ_PBOM_RECORD t1
    where t1.p_bom_digifax_id=(
    select t3.puid from Hz_Bom_Main_Record t3 where t3.p_cfg0_of_which_project_puid=(
    select t2.puid from Hz_project_libs t2
    <where>
      t2.puid=#{projectId,jdbcType=VARCHAR}))
      and
      t1.P_BOM_LINE_ID = #{lineId,jdbcType=VARCHAR}
      and t1.P_PBOM_STATUS <![CDATA[ <> ]]>0
    </where>
  </select>

  <!--批量删除 真的删除-->
  <update id="HzPbomRecordDAOImpl_deleteListByPuids"  parameterType="java.util.HashMap">
    <foreach collection="eBomPuids" item="item" index="index" open="begin" close=";end;" separator=";">
      delete HZ_PBOM_RECORD
      where P_E_BOM_PUID = #{eBomPuids[${index}]}
    </foreach>
  </update>



  <!--批量删除-->
  <update id="HzPbomRecordDAOImpl_deleteList"  parameterType="java.util.List">
    <foreach collection="list" item="item" index="index" open="begin" close=";end;" separator=";">
      update HZ_PBOM_RECORD
      <set>
        P_PBOM_STATUS=0,
        P_UPDATE_TIME =sysdate
      </set>
      where P_E_BOM_PUID = #{item.eBomPuid,jdbcType=VARCHAR}
    </foreach>
  </update>



    <!--分页查询 回收站-->
    <select id="HzPbomRecordDAOImpl_getHzPbomRecycleRecord" resultMap="HzPbomLineRecord" parameterType="java.util.HashMap">
        select * FROM
        (SELECT u.*,rownum as rn from
        (SELECT <include refid="Pbom_List"/> from HZ_PBOM_RECORD
        where p_bom_digifax_id=(
        select t3.puid from Hz_Bom_Main_Record t3 where t3.p_cfg0_of_which_project_puid=(
        select t2.puid from Hz_project_libs t2
        <where>
            t2.puid=#{projectId,jdbcType=VARCHAR}))
            and (P_UPDATE_TIME BETWEEN
            (SYSDATE-7) and
            (sysdate)) and
            P_PBOM_STATUS = 0 ORDER BY P_UPDATE_TIME DESC
            )u
        </where>
        WHERE ROWNUM &lt;=#{limit,jdbcType=INTEGER}) where rn &gt;#{offset,jdbcType=INTEGER}
    </select>


    <!--查询 回收站-->
    <select id="HzPbomRecordDAOImpl_getRecycleTotalCount" resultType="java.lang.Integer" parameterType="java.util.HashMap">
        SELECT count(*) from HZ_PBOM_RECORD t1
        where t1.p_bom_digifax_id=(
        select t3.puid from Hz_Bom_Main_Record t3 where t3.p_cfg0_of_which_project_puid=(
        select t2.puid from Hz_project_libs t2
        <where>
            t2.puid=#{projectId,jdbcType=VARCHAR}))
            and (t1.P_UPDATE_TIME BETWEEN
            (SYSDATE-7) and
            (sysdate)) and
            t1.P_PBOM_STATUS = 0
        </where>
    </select>


  <!--找出大于当前排序号的最小排序号-->
  <select id="HzPbomRecordDAOImpl_findMinOrderNumWhichGreaterThanThisOrderNum" parameterType="java.util.HashMap" resultType="java.lang.String">
    SELECT * FROM (
    SELECT P_SORT_NUM  FROM HZ_PBOM_RECORD
    where p_bom_digifax_id=(
    select t3.puid from Hz_Bom_Main_Record t3 where t3.p_cfg0_of_which_project_puid=(
    select t2.puid from Hz_project_libs t2
    <where>
      t2.puid=#{projectId,jdbcType=VARCHAR}))
    </where>
    and   P_PBOM_STATUS <![CDATA[ <> ]]>0
    and  CAST(P_SORT_NUM as FLOAT) &gt;#{sortNum,jdbcType=DOUBLE}
    ORDER BY  CAST(P_SORT_NUM as FLOAT))WHERE rownum =1
  </select>

  <!--删除-->
  <delete id="HzPbomRecordDAOImpl_delete"  parameterType="java.lang.String">
        delete  HZ_PBOM_RECORD
        where P_E_BOM_PUID = #{eBomPuid,jdbcType=VARCHAR}
    </delete>



  <!--获取全部的2Y层-->
  <select id="HzPbomRecordDAOImpl_getAll2YBomRecord" parameterType="java.util.HashMap" resultMap="HzPbomLineRecord">
    select * from HZ_PBOM_RECORD t1
    where t1.p_bom_digifax_id=(
    select t3.puid from Hz_Bom_Main_Record t3 where t3.p_cfg0_of_which_project_puid=(
    select t2.puid from Hz_project_libs t2
    <where>
      t2.puid=#{projectId,jdbcType=VARCHAR}))
      and t1.P_BOM_LINE_IS_2Y=1
      and t1.P_PBOM_STATUS<![CDATA[ <> ]]>0
    </where>
    ORDER BY  CAST(P_SORT_NUM as FLOAT)
  </select>

  <insert id="HzPbomRecordDAOImpl_insertAccessories" parameterType="java.util.Map">
      insert into HZ_PBOM_RECORD
      set (PUID, P_BOM_LINE_ID, P_BOM_LINE_PART_NAME)

  </insert>

  <!--获取当前BOM的子一层结构-->
    <select id="HzPbomRecordDAOImpl_getFirstLevelBomByParentId" parameterType="java.util.HashMap" resultMap="HzPbomLineRecord">
        select * from HZ_PBOM_RECORD t1
        where t1.p_bom_digifax_id=(
        select t3.puid from Hz_Bom_Main_Record t3 where t3.p_cfg0_of_which_project_puid=(
        select t2.puid from Hz_project_libs t2
        <where>
            t2.puid=#{projectId,jdbcType=VARCHAR}))
            <if test="parentId != null">
                and t1.P_PARENT_UID = #{parentId,jdbcType=VARCHAR}
            </if>
            and t1.P_PBOM_STATUS<![CDATA[ <> ]]>0
        </where>
    </select>

  <!--<select id="HzPbomRecordDAOImpl_getFirstLevelBomByParentLineIndexLength" parameterType="java.util.HashMap" resultMap="HzPbomLineRecord">-->
    <!--select * from HZ_PBOM_RECORD t1-->
    <!--where t1.p_bom_digifax_id=(-->
    <!--select t3.puid from Hz_Bom_Main_Record t3 where t3.p_cfg0_of_which_project_puid=(-->
    <!--select t2.puid from Hz_project_libs t2-->
    <!--<where>-->
      <!--t2.puid=#{projectId,jdbcType=VARCHAR}))-->
      <!--and LENGTH(TRANSLATE(t1.P_LINE_INDEX,',0123456789','.'))=#{length,jdbcType=VARCHAR}-->
      <!--start with t1.P_E_BOM_PUID = #{puid,jdbcType=VARCHAR} and t.P_PBOM_STATUS <![CDATA[ <> ]]>0-->
      <!--connect by prior t1.P_E_BOM_PUID = t.p_parent_uid and t.P_PBOM_STATUS<![CDATA[ <> ]]>0-->
      <!--order by CAST(t1.P_SORT_NUM as FLOAT)-->
    <!--</where>-->
  <!--</select>-->

  <select id="HzPbomRecordDAOImpl_queryAllBomLineIdByPuid" parameterType="java.util.Map" resultMap="HzPbomLineRecord">
    select
      <include refid="Pbom_List"/>
    from
      HZ_PBOM_RECORD
    where
      P_BOM_LINE_ID = (select P_BOM_LINE_ID from HZ_PBOM_RECORD where P_E_BOM_PUID = #{puid, jdbcType=VARCHAR})
      and
    P_BOM_DIGIFAX_ID = (select PUID from HZ_BOM_MAIN_RECORD where P_CFG0_OF_WHICH_PROJECT_PUID = #{projectId, jdbcType=VARCHAR})
    and
      P_PBOM_STATUS = 1
  </select>
</mapper>