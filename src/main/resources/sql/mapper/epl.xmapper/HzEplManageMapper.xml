<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="HzEplManageRecord">
  <resultMap id="BaseResultMap" type="sql.pojo.epl.HzEPLManageRecord">
    <id column="PUID" jdbcType="VARCHAR" property="puid" />
    <result column="P_LINE_INDEX" jdbcType="VARCHAR" property="lineIndex" />
    <result column="P_BOM_LINE_IS_HAS" jdbcType="INTEGER" property="isHas" />
    <result column="P_BOM_LINE_ID" jdbcType="VARCHAR" property="lineID" />
    <result column="P_BOM_LINE_IS_2Y" jdbcType="INTEGER" property="is2Y" />
    <result column="P_BOM_OF_WHICH_DEPT" jdbcType="VARCHAR" property="pBomOfWhichDept" />
    <result column="P_PARENT_UID" jdbcType="VARCHAR" property="parentUid"/>
    <result column="P_BOM_DIGIFAX_ID" jdbcType="VARCHAR" property="bomDigifaxId"/>
      <result column="P_BOM_LINE_PUID" jdbcType="VARCHAR" property="linePuid"/>
    <result column="P_BOM_LINE_IS_PART" jdbcType="INTEGER" property="isPart"/>
    <result column="P_BOM_ORDER_NUM" jdbcType="INTEGER" property="orderNum"/>
    <result column="P_BOM_LINE_IS_DEPT" jdbcType="INTEGER" property="isDept"/>
    <result column="P_BOM_LINE_PART_NAME" jdbcType="VARCHAR" property="pBomLinePartName"/>
    <result column="P_BOM_LINE_PART_CLASS" jdbcType="VARCHAR" property="pBomLinePartClass"/>
      <result column="P_BOM_LINE_PART_EN_NAME" jdbcType="VARCHAR" property="pBomLinePartEnName" />
      <result column="P_BOM_LINE_PART_RESOURCE" jdbcType="VARCHAR" property="pBomLinePartResource" />
      <result column="P_SORT_NUM" jdbcType="VARCHAR" property="sortNum" />

      <result column="P_FNA_INFO" jdbcType="VARCHAR" property="fna" />
      <result column="P_FASTENER" jdbcType="VARCHAR" property="pFastener" />
      <!--<result column="P_LOUA_FLAG" jdbcType="INTEGER" property="pLouaFlag" />-->
      <result column="P_3CPART_FLAG" jdbcType="INTEGER" property="p3cpartFlag" />
      <result column="P_IN_OUT_SIDE_FLAG" jdbcType="INTEGER" property="pInOutSideFlag" />
      <result column="P_UPC" jdbcType="VARCHAR" property="pUpc" />
      <result column="P_FNA_DESC" jdbcType="VARCHAR" property="pFnaDesc" />
      <result column="P_CREATE_NAME" jdbcType="VARCHAR" property="pCreateName" />
      <result column="P_UPDATE_NAME" jdbcType="VARCHAR" property="pUpdateName" />
      <result column="P_UNIT" jdbcType="VARCHAR" property="pUnit" />
      <result column="P_PICTURE_NO" jdbcType="VARCHAR" property="pPictureNo" />
      <result column="P_PICTURE_SHEET" jdbcType="VARCHAR" property="pPictureSheet" />
      <result column="P_MATERIAL_HIGH" jdbcType="VARCHAR" property="pMaterialHigh" />
      <result column="P_MATERIAL1" jdbcType="VARCHAR" property="pMaterial1" />
      <result column="P_MATERIAL2" jdbcType="VARCHAR" property="pMaterial2" />
      <result column="P_MATERIAL3" jdbcType="VARCHAR" property="pMaterial3" />
      <result column="P_DENSITY" jdbcType="VARCHAR" property="pDensity" />
      <result column="P_MATERIAL_STANDARD" jdbcType="VARCHAR" property="pMaterialStandard" />
      <result column="P_SURFACE_TREAT" jdbcType="VARCHAR" property="pSurfaceTreat" />
      <result column="P_TEXTURE_COLOR_NUM" jdbcType="VARCHAR" property="pTextureColorNum" />
      <result column="P_MANU_PROCESS" jdbcType="VARCHAR" property="pManuProcess" />
      <result column="P_SYMMETRY" jdbcType="VARCHAR" property="pSymmetry" />
      <result column="P_IMPORTANCE" jdbcType="VARCHAR" property="pImportance" />
      <result column="P_REGULATION_FLAG" jdbcType="INTEGER" property="pRegulationFlag" />
      <result column="P_BWG_BOX_PART" jdbcType="VARCHAR" property="pBwgBoxPart" />
      <result column="P_DEVELOP_TYPE" jdbcType="VARCHAR" property="pDevelopType" />
      <result column="P_DATA_VERSION" jdbcType="VARCHAR" property="pDataVersion" />
      <result column="P_TARGET_WEIGHT" jdbcType="VARCHAR" property="pTargetWeight" />
      <result column="P_FEATURE_WEIGHT" jdbcType="VARCHAR" property="pFeatureWeight" />
      <result column="P_ACTUAL_WEIGHT" jdbcType="VARCHAR" property="pActualWeight" />
      <result column="P_FASTENER_STANDARD" jdbcType="VARCHAR" property="pFastenerStandard" />
      <result column="P_FASTENER_LEVEL" jdbcType="VARCHAR" property="pFastenerLevel" />
      <result column="P_TORQUE" jdbcType="VARCHAR" property="pTorque" />
      <result column="P_DUTY_ENGINEER" jdbcType="VARCHAR" property="pDutyEngineer" />
      <result column="P_SUPPLY" jdbcType="VARCHAR" property="pSupply" />
      <result column="P_SUPPLY_CODE" jdbcType="VARCHAR" property="pSupplyCode" />
      <result column="P_REMARK" jdbcType="VARCHAR" property="pRemark" />
      <result column="P_REGULATION_CODE" jdbcType="VARCHAR" property="pRegulationCode" />
      <result column="P_EBOM_STATUS" jdbcType="VARCHAR" property="status" />
      <result column="P_NUMBER" jdbcType="VARCHAR" property="number" />
      <result column="P_BUY_ENGINEER" jdbcType="INTEGER" property="pBuyEngineer" />
      <result column="P_EWO_NO" jdbcType="VARCHAR" property="ewoNo"/>
      <result column="P_LOU_LOA_FLAG" jdbcType="INTEGER" property="pLouaFlag"/>

    <!--PBOM-->
    <result column="P_ITEM_RESOURCE" jdbcType="VARCHAR" property="itemResource" />
    <result column="P_RESOURCE" jdbcType="VARCHAR" property="resource" />
    <result column="P_TYPE" jdbcType="INTEGER" property="type" />
    <result column="P_BUY_UNIT" jdbcType="INTEGER" property="buyUnit" />
    <result column="P_WORK_SHOP1" jdbcType="VARCHAR" property="workShop1" />
    <result column="P_WORK_SHOP2" jdbcType="VARCHAR" property="workShop2" />
    <result column="P_PRODUCT_LINE" jdbcType="VARCHAR" property="productLine" />
    <result column="P_MOULD_TYPE" jdbcType="VARCHAR" property="mouldType" />
    <result column="P_OUTER_PART" jdbcType="VARCHAR" property="outerPart" />
        <result column="P_COLOR_PART" jdbcType="INTEGER" property="colorPart" />
    <!--MBOM-->
    <result column="P_SPARE_PART" jdbcType="VARCHAR" property="sparePart" />
    <result column="P_SPARE_PART_NUM" jdbcType="VARCHAR" property="sparePartNum" />
    <result column="P_PROCESS_ROUTE" jdbcType="VARCHAR" property="processRoute" />
    <result column="P_LABOR_HOUR" jdbcType="VARCHAR" property="laborHour" />
    <result column="P_RHYTHM" jdbcType="VARCHAR" property="rhythm" />
    <result column="P_SOLDER_JOINT" jdbcType="VARCHAR" property="solderJoint" />
    <!--<result column="P_MACHINE_MATERIAL" jdbcType="VARCHAR" property="machineMaterial" />-->
    <result column="P_STANDARD_PART" jdbcType="VARCHAR" property="standardPart" />
    <result column="P_TOOLS" jdbcType="VARCHAR" property="tools" />
    <result column="P_WASTER_PRODUCT" jdbcType="VARCHAR" property="wasterProduct" />
    <result column="P_CHANGE" jdbcType="VARCHAR" property="change" />
    <result column="P_CHANGE_NUM" jdbcType="VARCHAR" property="changeNum" />
  </resultMap>

    <sql id="EBOM_COLUMN">
    PUID, P_PARENT_UID, P_BOM_DIGIFAX_ID, P_LINE_INDEX, P_BOM_LINE_IS_HAS, P_BOM_LINE_PUID,
    P_BOM_LINE_ID, P_BOM_LINE_IS_2Y, P_BOM_LINE_IS_PART, P_BOM_ORDER_NUM, P_BOM_LINE_IS_DEPT,
    P_BOM_OF_WHICH_DEPT, P_BOM_LINE_PART_NAME, P_BOM_LINE_PART_CLASS, P_BOM_LINE_PART_EN_NAME,
    P_BOM_LINE_PART_RESOURCE
  </sql>

  <!--<sql id="Pbom_List">-->
    <!--P_PUID,P_LINE_INDEX,P_BOM_LINE_IS_HAS,P_BOM_LINE_ID,P_BOM_LINE_IS_2Y,P_BOM_OF_WHICH_DEPT-->
  <!--</sql>-->
  <!--联表查询 EPL全信息-->
  <select id="HzEplManageRecordDAOImpl_getHzEplManageRecord" resultMap="BaseResultMap">
      SELECT t1.* from HZ_BOM_LINE_RECORD t1
      LEFT OUTER JOIN HZ_MBOM_RECORD t4 on t1.Puid = t4.P_BOM_PUID
      LEFT OUTER JOIN HZ_PBOM_RECORD t5 on t1.PUID=t5.P_E_BOM_PUID
      where t1.p_bom_digifax_id=(
      select t3.puid from Hz_Bom_Main_Record t3 where t3.p_cfg0_of_which_project_puid=(
      select t2.puid from Hz_project_libs t2
      <where>
        t2.puid=#{projectId,jdbcType=VARCHAR}))
      <!--<if test="lineIndex != null and lineIndex!=''">-->
        <!--and LENGTH(TRANSLATE(t1.P_LINE_INDEX,',0123456789','.'))=#{lineIndex,jdbcType=VARCHAR}-->
      <!--</if>-->
      <!--<if test="isHas != null and isHas==0">-->
          <!--and (t1.P_BOM_LINE_IS_HAS = 0 or t1.P_BOM_LINE_IS_HAS = 1)-->
      <!--</if>-->
      <!--<if test="isHas != null and isHas==1">-->
          <!--and t1.P_BOM_LINE_IS_HAS = 1-->
      <!--</if>-->
      <if test="lineId != null and lineId!=''" >
          and t1.P_BOM_LINE_ID like CONCAT(CONCAT('%',#{lineId,jdbcType=VARCHAR}),'%')
      </if>
      <if test="pBomOfWhichDept != null and  pBomOfWhichDept!='' " >
          and t1.P_BOM_OF_WHICH_DEPT like CONCAT(CONCAT('%',#{pBomOfWhichDept,jdbcType=VARCHAR}),'%')
      </if>
      <if test="pFastener ==1 " >
          and t1.P_FASTENER is not null
      </if>
      <if test="pFastener ==2 " >
          and t1.P_FASTENER is  null
      </if>
      </where>
  </select>

    <select id="HzEplManageRecordDAOImpl_getHzEplManageRecord2" resultMap="BaseResultMap">
        select * FROM(
        SELECT u.*,rownum as rn from(
        select * from (


        <!-- 两表UNION-->
        select
        t.PUID PUID,

        t.P_LINE_INDEX 	P_LINE_INDEX,
        t.P_BOM_LINE_IS_HAS 	P_BOM_LINE_IS_HAS,
        t.P_BOM_LINE_ID 	P_BOM_LINE_ID,
        t.P_BOM_LINE_IS_2Y 		P_BOM_LINE_IS_2Y,
        t.P_BOM_OF_WHICH_DEPT 	P_BOM_OF_WHICH_DEPT,
        t.P_PARENT_UID 		P_PARENT_UID,
        t.P_BOM_DIGIFAX_ID 		P_BOM_DIGIFAX_ID,
        t.P_BOM_LINE_PUID 		P_BOM_LINE_PUID,
        t.P_BOM_LINE_IS_PART 		P_BOM_LINE_IS_PART,
        t.P_BOM_ORDER_NUM 		P_BOM_ORDER_NUM,
        t.P_BOM_LINE_IS_DEPT 		P_BOM_LINE_IS_DEPT,
        t.P_BOM_LINE_PART_NAME 		P_BOM_LINE_PART_NAME,
        t.P_BOM_LINE_PART_CLASS 		P_BOM_LINE_PART_CLASS,
        t.P_BOM_LINE_PART_EN_NAME 		P_BOM_LINE_PART_EN_NAME,
        t.P_BOM_LINE_PART_RESOURCE 		P_BOM_LINE_PART_RESOURCE,
        t.P_SORT_NUM 		P_SORT_NUM,
        t.P_FNA_INFO 		P_FNA_INFO,
        t.P_FASTENER 		P_FASTENER,

        t.P_3CPART_FLAG 		P_3CPART_FLAG,
        t.P_IN_OUT_SIDE_FLAG 		P_IN_OUT_SIDE_FLAG,
        t.P_UPC 		P_UPC,
        t.P_FNA_DESC 		P_FNA_DESC,
        t.P_CREATE_NAME 		P_CREATE_NAME,
        t.P_UPDATE_NAME		P_UPDATE_NAME,
        t.P_UNIT 		P_UNIT,
        t.P_PICTURE_NO		P_PICTURE_NO,
        t.P_PICTURE_SHEET		P_PICTURE_SHEET,
        t.P_MATERIAL_HIGH		P_MATERIAL_HIGH,
        t.P_MATERIAL1		P_MATERIAL1,
        t.P_MATERIAL2		P_MATERIAL2,
        t.P_MATERIAL3		P_MATERIAL3,
        t.P_DENSITY		P_DENSITY	,
        t.P_MATERIAL_STANDARD		P_MATERIAL_STANDARD,
        t.P_SURFACE_TREAT		P_SURFACE_TREAT,
        t.P_TEXTURE_COLOR_NUM		P_TEXTURE_COLOR_NUM,
        t.P_MANU_PROCESS		P_MANU_PROCESS,
        t.P_SYMMETRY		P_SYMMETRY,
        t.P_IMPORTANCE		P_IMPORTANCE,
        t.P_REGULATION_FLAG		P_REGULATION_FLAG,
        t.P_BWG_BOX_PART		P_BWG_BOX_PART,
        t.P_DEVELOP_TYPE		P_DEVELOP_TYPE,
        t.P_DATA_VERSION		P_DATA_VERSION,
        t.P_TARGET_WEIGHT		P_TARGET_WEIGHT,
        t.P_FEATURE_WEIGHT		P_FEATURE_WEIGHT,
        t.P_ACTUAL_WEIGHT		P_ACTUAL_WEIGHT,
        t.P_FASTENER_STANDARD		P_FASTENER_STANDARD,
        t.P_FASTENER_LEVEL		P_FASTENER_LEVEL,
        t.P_TORQUE		P_TORQUE,
        t.P_DUTY_ENGINEER		P_DUTY_ENGINEER,
        t.P_SUPPLY		P_SUPPLY,
        t.P_SUPPLY_CODE		P_SUPPLY_CODE,
        t.P_REMARK		P_REMARK,
        t.P_REGULATION_CODE		P_REGULATION_CODE,
        t.P_EBOM_STATUS		P_EBOM_STATUS,
        t.P_NUMBER		P_NUMBER,
        t.P_BUY_ENGINEER		P_BUY_ENGINEER,
        t.P_EWO_NO		P_EWO_NO,
        t.P_LOU_LOA_FLAG		P_LOU_LOA_FLAG,


        t2.P_SPARE_PART 	P_SPARE_PART,
        t2.P_SPARE_PART_NUM		P_SPARE_PART_NUM,
        t2.P_PROCESS_ROUTE		P_PROCESS_ROUTE,
        t2.P_LABOR_HOUR		P_LABOR_HOUR,
        t2.P_RHYTHM		P_RHYTHM,
        t2.P_SOLDER_JOINT		P_SOLDER_JOINT,

        t2.P_STANDARD_PART		P_STANDARD_PART,
        t2.P_TOOLS		P_TOOLS,
        t2.P_WASTER_PRODUCT		P_WASTER_PRODUCT,
        t2.P_CHANGE		P_CHANGE,
        t2.P_CHANGE_NUM		P_CHANGE_NUM,





        t3.P_RESOURCE		P_RESOURCE,
        t3.P_TYPE		P_TYPE,
        t3.P_BUY_UNIT		P_BUY_UNIT,
        t3.P_WORK_SHOP1		P_WORK_SHOP1,
        t3.P_WORK_SHOP2		P_WORK_SHOP2,
        t3.P_PRODUCT_LINE		P_PRODUCT_LINE,
        t3.P_MOULD_TYPE		P_MOULD_TYPE,
        t3.P_OUTER_PART		P_OUTER_PART,
        t3.P_COLOR_PART		P_COLOR_PART


        from (
        select




        t1.PUID PUID,

        t1.P_LINE_INDEX 	P_LINE_INDEX,
        t1.P_BOM_LINE_IS_HAS 	P_BOM_LINE_IS_HAS,
        t1.P_BOM_LINE_ID 	P_BOM_LINE_ID,
        t1.P_BOM_LINE_IS_2Y 		P_BOM_LINE_IS_2Y,
        t1.P_BOM_OF_WHICH_DEPT 	P_BOM_OF_WHICH_DEPT,
        t1.P_PARENT_UID 		P_PARENT_UID,
        t1.P_BOM_DIGIFAX_ID 		P_BOM_DIGIFAX_ID,
        t1.P_BOM_LINE_PUID 		P_BOM_LINE_PUID,
        t1.P_BOM_LINE_IS_PART 		P_BOM_LINE_IS_PART,
        t1.P_BOM_ORDER_NUM 		P_BOM_ORDER_NUM,
        t1.P_BOM_LINE_IS_DEPT 		P_BOM_LINE_IS_DEPT,
        t1.P_BOM_LINE_PART_NAME 		P_BOM_LINE_PART_NAME,
        t1.P_BOM_LINE_PART_CLASS 		P_BOM_LINE_PART_CLASS,
        t1.P_BOM_LINE_PART_EN_NAME 		P_BOM_LINE_PART_EN_NAME,
        t1.P_BOM_LINE_PART_RESOURCE 		P_BOM_LINE_PART_RESOURCE,
        t1.P_SORT_NUM 		P_SORT_NUM,
        t1.P_FNA_INFO 		P_FNA_INFO,
        t1.P_FASTENER 		P_FASTENER,

        t1.P_3CPART_FLAG 		P_3CPART_FLAG,
        t1.P_IN_OUT_SIDE_FLAG 		P_IN_OUT_SIDE_FLAG,
        t1.P_UPC 		P_UPC,
        t1.P_FNA_DESC 		P_FNA_DESC,
        t1.P_CREATE_NAME 		P_CREATE_NAME,
        t1.P_UPDATE_NAME		P_UPDATE_NAME,
        t1.P_UNIT 		P_UNIT,
        t1.P_PICTURE_NO		P_PICTURE_NO,
        t1.P_PICTURE_SHEET		P_PICTURE_SHEET,
        t1.P_MATERIAL_HIGH		P_MATERIAL_HIGH,
        t1.P_MATERIAL1		P_MATERIAL1,
        t1.P_MATERIAL2		P_MATERIAL2,
        t1.P_MATERIAL3		P_MATERIAL3,
        t1.P_DENSITY		P_DENSITY	,
        t1.P_MATERIAL_STANDARD		P_MATERIAL_STANDARD,
        t1.P_SURFACE_TREAT		P_SURFACE_TREAT,
        t1.P_TEXTURE_COLOR_NUM		P_TEXTURE_COLOR_NUM,
        t1.P_MANU_PROCESS		P_MANU_PROCESS,
        t1.P_SYMMETRY		P_SYMMETRY,
        t1.P_IMPORTANCE		P_IMPORTANCE,
        t1.P_REGULATION_FLAG		P_REGULATION_FLAG,
        t1.P_BWG_BOX_PART		P_BWG_BOX_PART,
        t1.P_DEVELOP_TYPE		P_DEVELOP_TYPE,
        t1.P_DATA_VERSION		P_DATA_VERSION,
        t1.P_TARGET_WEIGHT		P_TARGET_WEIGHT,
        t1.P_FEATURE_WEIGHT		P_FEATURE_WEIGHT,
        t1.P_ACTUAL_WEIGHT		P_ACTUAL_WEIGHT,
        t1.P_FASTENER_STANDARD		P_FASTENER_STANDARD,
        t1.P_FASTENER_LEVEL		P_FASTENER_LEVEL,
        t1.P_TORQUE		P_TORQUE,
        t1.P_DUTY_ENGINEER		P_DUTY_ENGINEER,
        t1.P_SUPPLY		P_SUPPLY,
        t1.P_SUPPLY_CODE		P_SUPPLY_CODE,
        t1.P_REMARK		P_REMARK,
        t1.P_REGULATION_CODE		P_REGULATION_CODE,
        t1.P_EBOM_STATUS		P_EBOM_STATUS,
        t1.P_NUMBER		P_NUMBER,
        t1.P_BUY_ENGINEER		P_BUY_ENGINEER,
        t1.P_EWO_NO		P_EWO_NO,
        t1.P_LOU_LOA_FLAG		P_LOU_LOA_FLAG






        from HZ_BOM_LINE_RECORD t1
        where t1.P_BOM_LINE_ID in(

        SELECT P_BOM_LINE_ID FROM HZ_BOM_LINE_RECORD t1 where t1.p_bom_digifax_id =(
        SELECT t3.puid FROM Hz_Bom_Main_Record t3 WHERE t3.p_cfg0_of_which_project_puid = (
        SELECT t2.puid FROM Hz_project_libs t2 where
        t2.puid=#{projectId,jdbcType=VARCHAR}))GROUP BY P_BOM_LINE_ID)
        AND
        rowid  in(
        SELECT min(rowid) FROM(
        SELECT P_BOM_LINE_ID FROM HZ_BOM_LINE_RECORD t1 WHERE t1.p_bom_digifax_id = (
        SELECT t3.puid FROM Hz_Bom_Main_Record t3 WHERE t3.p_cfg0_of_which_project_puid = (
        SELECT t2.puid FROM Hz_project_libs t2 where t2.puid=#{projectId,jdbcType=VARCHAR})) ) GROUP BY P_BOM_LINE_ID
        )
        )t
        LEFT OUTER JOIN HZ_MBOM_RECORD t2 on t.Puid = t2.P_BOM_PUID
        LEFT OUTER JOIN HZ_PBOM_RECORD t3 on t.PUID=t3.P_E_BOM_PUID

        UNION ALL



        select



        t3.PUID		PUID,
        t.P_LINE_INDEX 	P_LINE_INDEX,
        t.P_BOM_LINE_IS_HAS 	P_BOM_LINE_IS_HAS,
        t3.P_BOM_LINE_ID		P_BOM_LINE_ID,
        t.P_BOM_LINE_IS_2Y 		P_BOM_LINE_IS_2Y,
        t.P_BOM_OF_WHICH_DEPT 	P_BOM_OF_WHICH_DEPT,
        t.P_PARENT_UID 		P_PARENT_UID,
        t.P_BOM_DIGIFAX_ID 		P_BOM_DIGIFAX_ID,
        t.P_BOM_LINE_PUID 		P_BOM_LINE_PUID,
        t.P_BOM_LINE_IS_PART 		P_BOM_LINE_IS_PART,
        t.P_BOM_ORDER_NUM 		P_BOM_ORDER_NUM,
        t.P_BOM_LINE_IS_DEPT 		P_BOM_LINE_IS_DEPT,
        t.P_BOM_LINE_PART_NAME 		P_BOM_LINE_PART_NAME,
        t.P_BOM_LINE_PART_CLASS 		P_BOM_LINE_PART_CLASS,
        t.P_BOM_LINE_PART_EN_NAME 		P_BOM_LINE_PART_EN_NAME,
        t.P_BOM_LINE_PART_RESOURCE 		P_BOM_LINE_PART_RESOURCE,
        t.P_SORT_NUM 		P_SORT_NUM,
        t.P_FNA_INFO 		P_FNA_INFO,
        t.P_FASTENER 		P_FASTENER,

        t.P_3CPART_FLAG 		P_3CPART_FLAG,
        t.P_IN_OUT_SIDE_FLAG 		P_IN_OUT_SIDE_FLAG,
        t.P_UPC 		P_UPC,
        t.P_FNA_DESC 		P_FNA_DESC,
        t.P_CREATE_NAME 		P_CREATE_NAME,
        t.P_UPDATE_NAME		P_UPDATE_NAME,
        t.P_UNIT 		P_UNIT,
        t.P_PICTURE_NO		P_PICTURE_NO,
        t.P_PICTURE_SHEET		P_PICTURE_SHEET,
        t.P_MATERIAL_HIGH		P_MATERIAL_HIGH,
        t.P_MATERIAL1		P_MATERIAL1,
        t.P_MATERIAL2		P_MATERIAL2,
        t.P_MATERIAL3		P_MATERIAL3,
        t.P_DENSITY		P_DENSITY	,
        t.P_MATERIAL_STANDARD		P_MATERIAL_STANDARD,
        t.P_SURFACE_TREAT		P_SURFACE_TREAT,
        t.P_TEXTURE_COLOR_NUM		P_TEXTURE_COLOR_NUM,
        t.P_MANU_PROCESS		P_MANU_PROCESS,
        t.P_SYMMETRY		P_SYMMETRY,
        t.P_IMPORTANCE		P_IMPORTANCE,
        t.P_REGULATION_FLAG		P_REGULATION_FLAG,
        t.P_BWG_BOX_PART		P_BWG_BOX_PART,
        t.P_DEVELOP_TYPE		P_DEVELOP_TYPE,
        t.P_DATA_VERSION		P_DATA_VERSION,
        t.P_TARGET_WEIGHT		P_TARGET_WEIGHT,
        t.P_FEATURE_WEIGHT		P_FEATURE_WEIGHT,
        t.P_ACTUAL_WEIGHT		P_ACTUAL_WEIGHT,
        t.P_FASTENER_STANDARD		P_FASTENER_STANDARD,
        t.P_FASTENER_LEVEL		P_FASTENER_LEVEL,
        t.P_TORQUE		P_TORQUE,
        t.P_DUTY_ENGINEER		P_DUTY_ENGINEER,
        t.P_SUPPLY		P_SUPPLY,
        t.P_SUPPLY_CODE		P_SUPPLY_CODE,
        t.P_REMARK		P_REMARK,
        t.P_REGULATION_CODE		P_REGULATION_CODE,
        t.P_EBOM_STATUS		P_EBOM_STATUS,
        t.P_NUMBER		P_NUMBER,
        t.P_BUY_ENGINEER		P_BUY_ENGINEER,
        t.P_EWO_NO		P_EWO_NO,
        t.P_LOU_LOA_FLAG		P_LOU_LOA_FLAG,


        t2.P_SPARE_PART 	P_SPARE_PART,
        t2.P_SPARE_PART_NUM		P_SPARE_PART_NUM,
        t2.P_PROCESS_ROUTE		P_PROCESS_ROUTE,
        t2.P_LABOR_HOUR		P_LABOR_HOUR,
        t2.P_RHYTHM		P_RHYTHM,
        t2.P_SOLDER_JOINT		P_SOLDER_JOINT,

        t2.P_STANDARD_PART		P_STANDARD_PART,
        t2.P_TOOLS		P_TOOLS,
        t2.P_WASTER_PRODUCT		P_WASTER_PRODUCT,
        t2.P_CHANGE		P_CHANGE,
        t2.P_CHANGE_NUM		P_CHANGE_NUM,



        t3.P_RESOURCE		P_RESOURCE,
        t3.P_TYPE		P_TYPE,
        t3.P_BUY_UNIT		P_BUY_UNIT,
        t3.P_WORK_SHOP1		P_WORK_SHOP1,
        t3.P_WORK_SHOP2		P_WORK_SHOP2,
        t3.P_PRODUCT_LINE		P_PRODUCT_LINE,
        t3.P_MOULD_TYPE		P_MOULD_TYPE,
        t3.P_OUTER_PART		P_OUTER_PART,
        t3.P_COLOR_PART		P_COLOR_PART


        from HZ_BOM_LINE_RECORD t
        LEFT OUTER JOIN HZ_MBOM_RECORD t2 on t.Puid = t2.P_BOM_PUID
        RIGHT  OUTER JOIN
        (
        select
        t1.PUID		PUID,
        t1.P_BOM_LINE_ID		P_BOM_LINE_ID,
        t1.P_E_BOM_PUID		P_E_BOM_PUID ,

        t1.P_RESOURCE		P_RESOURCE,
        t1.P_TYPE		P_TYPE,
        t1.P_BUY_UNIT		P_BUY_UNIT,
        t1.P_WORK_SHOP1		P_WORK_SHOP1,
        t1.P_WORK_SHOP2		P_WORK_SHOP2,
        t1.P_PRODUCT_LINE		P_PRODUCT_LINE,
        t1.P_MOULD_TYPE		P_MOULD_TYPE,
        t1.P_OUTER_PART		P_OUTER_PART,
        t1.P_COLOR_PART		P_COLOR_PART


        from HZ_PBOM_RECORD t1
        where t1.P_BOM_LINE_ID in(

        SELECT P_BOM_LINE_ID FROM HZ_PBOM_RECORD t1 where t1.p_bom_digifax_id =(
        SELECT t3.puid FROM Hz_Bom_Main_Record t3 WHERE t3.p_cfg0_of_which_project_puid = (
        SELECT t2.puid FROM Hz_project_libs t2 where
        t2.puid=#{projectId,jdbcType=VARCHAR}))GROUP BY P_BOM_LINE_ID)
        AND
        rowid  in(
        SELECT min(rowid) FROM(
        SELECT P_BOM_LINE_ID FROM HZ_PBOM_RECORD t1 WHERE t1.p_bom_digifax_id = (
        SELECT t3.puid FROM Hz_Bom_Main_Record t3 WHERE t3.p_cfg0_of_which_project_puid = (
        SELECT t2.puid FROM Hz_project_libs t2 where t2.puid=#{projectId,jdbcType=VARCHAR})) ) GROUP BY P_BOM_LINE_ID
        )
        )t3	on t.PUID=t3.P_E_BOM_PUID

        <!-- 两表UNION-->




        )
        where PUID in(

        select MAX(PUID) from (
        select
        t.PUID PUID,
        t.P_BOM_LINE_ID
        from (
        select
        t1.PUID PUID,
        t1.P_BOM_LINE_ID

        from HZ_BOM_LINE_RECORD t1
        where t1.P_BOM_LINE_ID in(

        SELECT P_BOM_LINE_ID FROM HZ_BOM_LINE_RECORD t1 where t1.p_bom_digifax_id =(
        SELECT t3.puid FROM Hz_Bom_Main_Record t3 WHERE t3.p_cfg0_of_which_project_puid = (
        SELECT t2.puid FROM Hz_project_libs t2 where
        t2.puid=#{projectId,jdbcType=VARCHAR}))GROUP BY P_BOM_LINE_ID)

        AND
        rowid  in(
        SELECT min(rowid) FROM(
        SELECT P_BOM_LINE_ID FROM HZ_BOM_LINE_RECORD t1 WHERE t1.p_bom_digifax_id = (
        SELECT t3.puid FROM Hz_Bom_Main_Record t3 WHERE t3.p_cfg0_of_which_project_puid = (
        SELECT t2.puid FROM Hz_project_libs t2 where t2.puid=#{projectId,jdbcType=VARCHAR})) ) GROUP BY P_BOM_LINE_ID
        )

        )t
        LEFT OUTER JOIN HZ_MBOM_RECORD t2 on t.Puid = t2.P_BOM_PUID
        LEFT OUTER JOIN HZ_PBOM_RECORD t3 on t.PUID=t3.P_E_BOM_PUID

        UNION ALL

        select
        t3.PUID		PUID,
        t3.P_BOM_LINE_ID
        from HZ_BOM_LINE_RECORD t
        LEFT OUTER JOIN HZ_MBOM_RECORD t2 on t.Puid = t2.P_BOM_PUID
        RIGHT  OUTER JOIN
        (
        select
        t1.PUID		PUID,
        t1.P_BOM_LINE_ID,
        t1.P_E_BOM_PUID		P_E_BOM_PUID
        from HZ_PBOM_RECORD t1
        where t1.P_BOM_LINE_ID in(

        SELECT P_BOM_LINE_ID FROM HZ_PBOM_RECORD t1 where t1.p_bom_digifax_id =(
        SELECT t3.puid FROM Hz_Bom_Main_Record t3 WHERE t3.p_cfg0_of_which_project_puid = (
        SELECT t2.puid FROM Hz_project_libs t2 where
        t2.puid=#{projectId,jdbcType=VARCHAR}))GROUP BY P_BOM_LINE_ID)
        AND
        rowid  in(
        SELECT min(rowid) FROM(
        SELECT P_BOM_LINE_ID FROM HZ_PBOM_RECORD t1 WHERE t1.p_bom_digifax_id = (
        SELECT t3.puid FROM Hz_Bom_Main_Record t3 WHERE t3.p_cfg0_of_which_project_puid = (
        SELECT t2.puid FROM Hz_project_libs t2 where t2.puid=#{projectId,jdbcType=VARCHAR})) ) GROUP BY P_BOM_LINE_ID
        )
        )t3	on t.PUID=t3.P_E_BOM_PUID


        )t

        GROUP BY t.P_BOM_LINE_ID

        )
        )u
        WHERE
        ROWNUM &lt;=(#{limit,jdbcType=INTEGER}*(#{offset,jdbcType=INTEGER}+1))
        <if test="lineId != null and lineId!='' ">
            and u.P_BOM_LINE_ID like concat(concat('%', #{lineId, jdbcType=VARCHAR}), '%')
        </if>
        <if test="pBomOfWhichDept !=null and pBomOfWhichDept!='' ">
            and u.P_BOM_OF_WHICH_DEPT like concat(concat('%', #{pBomOfWhichDept, jdbcType=VARCHAR}), '%')
        </if>
        <if test="pFastener==1">
            and u.P_FASTENER is not null and u.P_FASTENER!='/'
        </if>
        <if test="pFastener==2">
            and (u.P_FASTENER is null or u.P_FASTENER='/')
        </if>
        order by CAST(P_SORT_NUM as FLOAT)) where rn &gt;(#{limit,jdbcType=INTEGER}*#{offset,jdbcType=INTEGER})
    </select>
  <!--查询EPL信息总数-->
  <select id="HzEplManageRecordDAOImpl_findTotalCount" resultType="java.lang.Integer" parameterType="java.util.HashMap">
      select count(*) from HZ_BOM_LINE_RECORD t1
      LEFT OUTER JOIN HZ_MBOM_RECORD t4 on t1.Puid = t4.P_BOM_PUID
      LEFT OUTER JOIN HZ_PBOM_RECORD t5 on t1.PUID=t5.P_E_BOM_PUID
      where t1.p_bom_digifax_id=(
      select t3.puid from Hz_Bom_Main_Record t3 where t3.p_cfg0_of_which_project_puid=(
      select t2.puid from Hz_project_libs t2
      <where>
          t2.puid=#{projectId,jdbcType=VARCHAR}))
      <if test="lineIndex != null and lineIndex!=''">
          and LENGTH(TRANSLATE(t1.P_LINE_INDEX,',0123456789','.'))=#{lineIndex,jdbcType=VARCHAR}
      </if>
      <if test="isHas != null and isHas==0">
          and (t1.P_BOM_LINE_IS_HAS = 0 or t1.P_BOM_LINE_IS_HAS = 1)
      </if>
      <if test="isHas != null and isHas==1">
          and t1.P_BOM_LINE_IS_HAS = 1
      </if>
      <if test="lineId != null and lineId!=''" >
          and t1.P_BOM_LINE_ID like CONCAT(CONCAT('%',#{lineId,jdbcType=VARCHAR}),'%')
      </if>
      <if test="pBomOfWhichDept != null and  pBomOfWhichDept!='' " >
          and t1.P_BOM_OF_WHICH_DEPT like CONCAT(CONCAT('%',#{pBomOfWhichDept,jdbcType=VARCHAR}),'%')
      </if>
      <if test="pFastener=1" >
          and t1.P_FASTENER is not null
      </if>
      <if test="pFastener=2 " >
          and t1.P_FASTENER is  null
      </if>
      </where>
  </select>

    <select id="HzEplManageRecordDAOImpl_findTotalCount2" resultType="java.lang.Integer" parameterType="java.util.HashMap">
        <!--select count(count(*)) from (-->
        <!--select-->
        <!--t.PUID PUID,-->
        <!--t.P_BOM_LINE_ID,-->
        <!--t.P_BOM_OF_WHICH_DEPT,-->
        <!--t.P_FASTENER-->
        <!--from (-->
        <!--select-->
        <!--t1.PUID PUID,-->
        <!--t1.P_BOM_LINE_ID,-->
        <!--t1.P_BOM_OF_WHICH_DEPT,-->
        <!--t1.P_FASTENER-->
        <!--from HZ_BOM_LINE_RECORD t1-->
        <!--where t1.P_BOM_LINE_ID in(-->

        <!--SELECT P_BOM_LINE_ID FROM HZ_BOM_LINE_RECORD t1 where t1.p_bom_digifax_id =(-->
        <!--SELECT t3.puid FROM Hz_Bom_Main_Record t3 WHERE t3.p_cfg0_of_which_project_puid = (-->
        <!--SELECT t2.puid FROM Hz_project_libs t2 where-->
        <!--t2.puid=#{projectId,jdbcType=VARCHAR}))GROUP BY P_BOM_LINE_ID)-->
        <!--AND-->
        <!--rowid  in(-->
        <!--SELECT min(rowid) FROM(-->
        <!--SELECT P_BOM_LINE_ID FROM HZ_BOM_LINE_RECORD t1 WHERE t1.p_bom_digifax_id = (-->
        <!--SELECT t3.puid FROM Hz_Bom_Main_Record t3 WHERE t3.p_cfg0_of_which_project_puid = (-->
        <!--SELECT t2.puid FROM Hz_project_libs t2 where t2.puid=#{projectId,jdbcType=VARCHAR})) ) GROUP BY P_BOM_LINE_ID-->
        <!--)-->

        <!--)t-->
        <!--LEFT OUTER JOIN HZ_MBOM_RECORD t2 on t.Puid = t2.P_BOM_PUID-->
        <!--LEFT OUTER JOIN HZ_PBOM_RECORD t3 on t.PUID=t3.P_E_BOM_PUID-->

        <!--UNION ALL-->

        <!--select-->
        <!--t3.PUID		PUID,-->
        <!--t3.P_BOM_LINE_ID,-->
        <!--t.P_BOM_OF_WHICH_DEPT,-->
        <!--t.P_FASTENER-->
        <!--from HZ_BOM_LINE_RECORD t-->
        <!--LEFT OUTER JOIN HZ_MBOM_RECORD t2 on t.Puid = t2.P_BOM_PUID-->
        <!--RIGHT  OUTER JOIN-->
        <!--(-->
        <!--select-->
        <!--t1.PUID		PUID,-->
        <!--t1.P_BOM_LINE_ID,-->
        <!--t1.P_E_BOM_PUID		P_E_BOM_PUID-->
        <!--from HZ_PBOM_RECORD t1-->
        <!--where t1.P_BOM_LINE_ID in(-->

        <!--SELECT P_BOM_LINE_ID FROM HZ_PBOM_RECORD t1 where t1.p_bom_digifax_id =(-->
        <!--SELECT t3.puid FROM Hz_Bom_Main_Record t3 WHERE t3.p_cfg0_of_which_project_puid = (-->
        <!--SELECT t2.puid FROM Hz_project_libs t2 where-->
        <!--t2.puid=#{projectId,jdbcType=VARCHAR}))GROUP BY P_BOM_LINE_ID)-->
        <!--AND-->
        <!--rowid  in(-->
        <!--SELECT min(rowid) FROM(-->
        <!--SELECT P_BOM_LINE_ID FROM HZ_PBOM_RECORD t1 WHERE t1.p_bom_digifax_id = (-->
        <!--SELECT t3.puid FROM Hz_Bom_Main_Record t3 WHERE t3.p_cfg0_of_which_project_puid = (-->
        <!--SELECT t2.puid FROM Hz_project_libs t2 where t2.puid=#{projectId,jdbcType=VARCHAR})) ) GROUP BY P_BOM_LINE_ID-->
        <!--)-->
        <!--)t3	on t.PUID=t3.P_E_BOM_PUID-->
        <!--)t-->
        <!--where-->
          <!--1=1-->
        <!--<if test="lineId != null and lineId!='' ">-->
            <!--and t.P_BOM_LINE_ID like concat(concat('%', #{lineId, jdbcType=VARCHAR}), '%')-->
        <!--</if>-->
        <!--<if test="pBomOfWhichDept !=null and pBomOfWhichDept!='' ">-->
            <!--and t.P_BOM_OF_WHICH_DEPT like concat(concat('%', #{pBomOfWhichDept, jdbcType=VARCHAR}), '%')-->
        <!--</if>-->
        <!--<if test="pFastener==1">-->
            <!--and t.P_FASTENER is not null and t.P_FASTENER!='/'-->
        <!--</if>-->
        <!--<if test="pFastener==2">-->
            <!--and (t.P_FASTENER is null or t.P_FASTENER='/')-->
        <!--</if>-->
        <!--GROUP BY t.P_BOM_LINE_ID-->



        select count(*) from (
        select
        t.PUID PUID,
        t.P_BOM_LINE_ID,
        t.P_BOM_OF_WHICH_DEPT,
        t.P_FASTENER
        from (
        select
        t1.PUID PUID,
        t1.P_BOM_LINE_ID,
        t1.P_BOM_OF_WHICH_DEPT,
        t1.P_FASTENER
        from HZ_BOM_LINE_RECORD t1
        where t1.P_BOM_LINE_ID in(

        SELECT P_BOM_LINE_ID FROM HZ_BOM_LINE_RECORD t1 where t1.p_bom_digifax_id =(
        SELECT t3.puid FROM Hz_Bom_Main_Record t3 WHERE t3.p_cfg0_of_which_project_puid = (
        SELECT t2.puid FROM Hz_project_libs t2 where
        t2.puid=#{projectId,jdbcType=VARCHAR}))GROUP BY P_BOM_LINE_ID)
        AND
        rowid  in(
        SELECT min(rowid) FROM(
        SELECT P_BOM_LINE_ID FROM HZ_BOM_LINE_RECORD t1 WHERE t1.p_bom_digifax_id = (
        SELECT t3.puid FROM Hz_Bom_Main_Record t3 WHERE t3.p_cfg0_of_which_project_puid = (
        SELECT t2.puid FROM Hz_project_libs t2 where t2.puid=#{projectId,jdbcType=VARCHAR})) ) GROUP BY P_BOM_LINE_ID
        )

        )t
        LEFT OUTER JOIN HZ_MBOM_RECORD t2 on t.Puid = t2.P_BOM_PUID
        LEFT OUTER JOIN HZ_PBOM_RECORD t3 on t.PUID=t3.P_E_BOM_PUID

        UNION ALL

        select
        t3.PUID		PUID,
        t3.P_BOM_LINE_ID,
        t.P_BOM_OF_WHICH_DEPT,
        t.P_FASTENER
        from HZ_BOM_LINE_RECORD t
        LEFT OUTER JOIN HZ_MBOM_RECORD t2 on t.Puid = t2.P_BOM_PUID
        RIGHT  OUTER JOIN
        (
        select
        t1.PUID		PUID,
        t1.P_BOM_LINE_ID,
        t1.P_E_BOM_PUID		P_E_BOM_PUID
        from HZ_PBOM_RECORD t1
        where t1.P_BOM_LINE_ID in(

        SELECT P_BOM_LINE_ID FROM HZ_PBOM_RECORD t1 where t1.p_bom_digifax_id =(
        SELECT t3.puid FROM Hz_Bom_Main_Record t3 WHERE t3.p_cfg0_of_which_project_puid = (
        SELECT t2.puid FROM Hz_project_libs t2 where
        t2.puid=#{projectId,jdbcType=VARCHAR}))GROUP BY P_BOM_LINE_ID)
        AND
        rowid  in(
        SELECT min(rowid) FROM(
        SELECT P_BOM_LINE_ID FROM HZ_PBOM_RECORD t1 WHERE t1.p_bom_digifax_id = (
        SELECT t3.puid FROM Hz_Bom_Main_Record t3 WHERE t3.p_cfg0_of_which_project_puid = (
        SELECT t2.puid FROM Hz_project_libs t2 where t2.puid=#{projectId,jdbcType=VARCHAR})) ) GROUP BY P_BOM_LINE_ID
        )
        )t3	on t.PUID=t3.P_E_BOM_PUID
        )t
        where

        PUID IN (
        SELECT
        MAX (PUID)
        FROM
        (
        SELECT
        T .PUID PUID,
        T .P_BOM_LINE_ID
        FROM
        (
        SELECT
        t1.PUID PUID,
        t1.P_BOM_LINE_ID
        FROM
        HZ_BOM_LINE_RECORD t1
        WHERE
        t1.P_BOM_LINE_ID IN (
        SELECT
        P_BOM_LINE_ID
        FROM
        HZ_BOM_LINE_RECORD t1
        WHERE
        t1.p_bom_digifax_id = (
        SELECT
        t3.puid
        FROM
        Hz_Bom_Main_Record t3
        WHERE
        t3.p_cfg0_of_which_project_puid = (
        SELECT
        t2.puid
        FROM
        Hz_project_libs t2
        WHERE
        t2.puid = #{projectId,jdbcType=VARCHAR}
        )
        )
        GROUP BY
        P_BOM_LINE_ID
        )
        AND ROWID IN (
        SELECT
        MIN (ROWID)
        FROM
        (
        SELECT
        P_BOM_LINE_ID
        FROM
        HZ_BOM_LINE_RECORD t1
        WHERE
        t1.p_bom_digifax_id = (
        SELECT
        t3.puid
        FROM
        Hz_Bom_Main_Record t3
        WHERE
        t3.p_cfg0_of_which_project_puid = (
        SELECT
        t2.puid
        FROM
        Hz_project_libs t2
        WHERE
        t2.puid = #{projectId,jdbcType=VARCHAR}
        )
        )
        )
        GROUP BY
        P_BOM_LINE_ID
        )
        ) T
        LEFT OUTER JOIN HZ_MBOM_RECORD t2 ON T .Puid = t2.P_BOM_PUID
        LEFT OUTER JOIN HZ_PBOM_RECORD t3 ON T .PUID = t3.P_E_BOM_PUID
        UNION ALL
        SELECT
        t3.PUID PUID,
        t3.P_BOM_LINE_ID
        FROM
        HZ_BOM_LINE_RECORD T
        LEFT OUTER JOIN HZ_MBOM_RECORD t2 ON T .Puid = t2.P_BOM_PUID
        RIGHT OUTER JOIN (
        SELECT
        t1.PUID PUID,
        t1.P_BOM_LINE_ID,
        t1.P_E_BOM_PUID P_E_BOM_PUID
        FROM
        HZ_PBOM_RECORD t1
        WHERE
        t1.P_BOM_LINE_ID IN (
        SELECT
        P_BOM_LINE_ID
        FROM
        HZ_PBOM_RECORD t1
        WHERE
        t1.p_bom_digifax_id = (
        SELECT
        t3.puid
        FROM
        Hz_Bom_Main_Record t3
        WHERE
        t3.p_cfg0_of_which_project_puid = (
        SELECT
        t2.puid
        FROM
        Hz_project_libs t2
        WHERE
        t2.puid = #{projectId,jdbcType=VARCHAR}
        )
        )
        GROUP BY
        P_BOM_LINE_ID
        )
        AND ROWID IN (
        SELECT
        MIN (ROWID)
        FROM
        (
        SELECT
        P_BOM_LINE_ID
        FROM
        HZ_PBOM_RECORD t1
        WHERE
        t1.p_bom_digifax_id = (
        SELECT
        t3.puid
        FROM
        Hz_Bom_Main_Record t3
        WHERE
        t3.p_cfg0_of_which_project_puid = (
        SELECT
        t2.puid
        FROM
        Hz_project_libs t2
        WHERE
        t2.puid = #{projectId,jdbcType=VARCHAR}
        )
        )
        )
        GROUP BY
        P_BOM_LINE_ID
        )
        ) t3 ON T .PUID = t3.P_E_BOM_PUID
        ) T
        GROUP BY
        T .P_BOM_LINE_ID
        )

        <if test="lineId != null and lineId!='' ">
            and t.P_BOM_LINE_ID like concat(concat('%', #{lineId, jdbcType=VARCHAR}), '%')
        </if>
        <if test="pBomOfWhichDept !=null and pBomOfWhichDept!='' ">
            and t.P_BOM_OF_WHICH_DEPT like concat(concat('%', #{pBomOfWhichDept, jdbcType=VARCHAR}), '%')
        </if>
        <if test="pFastener==1">
            and t.P_FASTENER is not null and t.P_FASTENER!='/'
        </if>
        <if test="pFastener==2">
            and (t.P_FASTENER is null or t.P_FASTENER='/')
        </if>

  </select>


  <!--查询 EBOM总数-->
  <select id="HzEbomRecordDAOImpl_findTotalCount" resultType="java.lang.Integer" parameterType="java.util.HashMap">
    SELECT count(*) from HZ_BOM_LINE_RECORD t1
    where t1.p_bom_digifax_id=(
    select t3.puid from Hz_Bom_Main_Record t3 where t3.p_cfg0_of_which_project_puid=(
    select t2.puid from Hz_project_libs t2
    <where>
      t2.puid=#{projectId,jdbcType=VARCHAR}))
    <if test="lineIndex != null and lineIndex!=''">
        and LENGTH(TRANSLATE(t1.P_LINE_INDEX,',0123456789','.'))=#{lineIndex,jdbcType=VARCHAR}
    </if>
    <if test="isHas != null and isHas==0">
        and t1.P_BOM_LINE_IS_HAS = 0
    </if>
    <if test="isHas != null and isHas==1">
        and t1.P_BOM_LINE_IS_HAS = 1
    </if>
    <if test="lineId != null and lineId!=''" >
        and t1.P_BOM_LINE_ID like CONCAT(CONCAT('%',#{lineId,jdbcType=VARCHAR}),'%')
    </if>
    <if test="pBomOfWhichDept != null and  pBomOfWhichDept!='' " >
        and t1.P_BOM_OF_WHICH_DEPT like CONCAT(CONCAT('%',#{pBomOfWhichDept,jdbcType=VARCHAR}),'%')
    </if>
    <if test="pBomLinePartClass != null and pBomLinePartClass!=''">
        and P_BOM_LINE_PART_CLASS = #{pBomLinePartClass,jdbcType=VARCHAR}
    </if>
    <if test="pBomLinePartResource != null and pBomLinePartResource!=''">
        and P_BOM_LINE_PART_RESOURCE = #{pBomLinePartResource,jdbcType=VARCHAR}
    </if>
        and t1.P_EBOM_STATUS <![CDATA[ <> ]]>0
    </where>
  </select>


  <!--查询bomLine的子bom 信息-->
  <select id="HzEbomRecordDAOImpl_getHzBomLineChildren"  resultMap="BaseResultMap" parameterType="java.util.HashMap">
    SELECT t1.* from HZ_BOM_LINE_RECORD t1
    where t1.p_bom_digifax_id=(
    select t3.puid from Hz_Bom_Main_Record t3 where t3.p_cfg0_of_which_project_puid=(
    select t2.puid from Hz_project_libs t2
    <where>
      t2.puid=#{projectId,jdbcType=VARCHAR}))
      <if test="colorPart != null">
        and t1.P_COLOR_PART = #{colorPart,jdbcType=INTEGER}
    </if>
        <if test="isCarPart == 1">
            and (t1.P_BOM_LINE_PART_RESOURCE ='采购件'or
            t1.P_BOM_LINE_PART_RESOURCE ='自制总成' or
            t1.P_BOM_LINE_PART_RESOURCE ='自制单件'or
            t1.P_BOM_LINE_PART_RESOURCE ='自用标准件'or
            t1.P_BOM_LINE_PART_RESOURCE ='自用非标件'or
            t1.P_BOM_LINE_PART_RESOURCE ='虚拟总成')
        </if>
    </where>
      start with t1.puid = #{puid,jdbcType=VARCHAR} and t1.P_EBOM_STATUS<![CDATA[ <> ]]>0
      connect by prior t1.puid = t1.p_parent_uid  and t1.P_EBOM_STATUS<![CDATA[ <> ]]>0
      order by CAST(t1.P_SORT_NUM as FLOAT)
  </select>

    <!--查询 一条EBOM全信息-->
    <select id="HzEbomRecordDAOImpl_findEbomById" resultMap="BaseResultMap" parameterType="java.util.HashMap">
        SELECT t1.*from HZ_BOM_LINE_RECORD t1
        where t1.p_bom_digifax_id=(
        select t3.puid from Hz_Bom_Main_Record t3 where t3.p_cfg0_of_which_project_puid=(
        select t2.puid from Hz_project_libs t2
        <where>
          t2.puid=#{projectId,jdbcType=VARCHAR}))
          and t1.puid = #{puid,jdbcType=VARCHAR}
          and t1.P_EBOM_STATUS <![CDATA[ <> ]]>0
        </where>
    </select>

    <!--查询 一条已删除EBOM全信息-->
    <select id="HzEbomRecordDAOImpl_findHasDeletedBom" resultMap="BaseResultMap" parameterType="java.util.HashMap">
        SELECT t1.*from HZ_BOM_LINE_RECORD t1
        where t1.p_bom_digifax_id=(
        select t3.puid from Hz_Bom_Main_Record t3 where t3.p_cfg0_of_which_project_puid=(
        select t2.puid from Hz_project_libs t2
        <where>
            t2.puid=#{projectId,jdbcType=VARCHAR}))
            and t1.puid = #{puid,jdbcType=VARCHAR}
            and t1.P_EBOM_STATUS=0
        </where>
    </select>

    <!-- 查找重名 -->
    <select id="HzEbomRecordDAOImpl_checkItemIdIsRepeat" parameterType="map" resultType="int">
        SELECT count(*) from HZ_BOM_LINE_RECORD t1
        where t1.p_bom_digifax_id=(
        select t3.puid from Hz_Bom_Main_Record t3 where t3.p_cfg0_of_which_project_puid=(
        select t2.puid from Hz_project_libs t2
        <where>
            t2.puid=#{projectId,jdbcType=VARCHAR}))
            and
            t1.P_BOM_LINE_ID = #{lineID,jdbcType=VARCHAR}
            and t1.P_EBOM_STATUS <![CDATA[ <> ]]>0
        </where>
    </select>

    <!--分页查询 EBOM全信息 回收站-->
    <select id="HzEbomRecordDAOImpl_getHzRecycleRecord" resultMap="BaseResultMap" parameterType="java.util.HashMap">
        select * FROM
        (SELECT u.*,rownum as rn from
        (SELECT <include refid="EBOM_COLUMN"/> from HZ_BOM_LINE_RECORD
        where p_bom_digifax_id=(
        select t3.puid from Hz_Bom_Main_Record t3 where t3.p_cfg0_of_which_project_puid=(
        select t2.puid from Hz_project_libs t2
        <where>
            t2.puid=#{projectId,jdbcType=VARCHAR}))
            and (P_UPDATE_TIME BETWEEN
            (SYSDATE-7) and
            (sysdate)) and
            P_EBOM_STATUS = 0 ORDER BY P_UPDATE_TIME DESC)u
        </where>
        WHERE ROWNUM &lt;=#{limit,jdbcType=INTEGER}) where rn &gt;#{offset,jdbcType=INTEGER}
    </select>


    <!--查询 EBOM总数 回收站-->
    <select id="HzEbomRecordDAOImpl_findRecycleTotalCount" resultType="java.lang.Integer" parameterType="java.util.HashMap">
        SELECT count(*) from HZ_BOM_LINE_RECORD t1
        where t1.p_bom_digifax_id=(
        select t3.puid from Hz_Bom_Main_Record t3 where t3.p_cfg0_of_which_project_puid=(
        select t2.puid from Hz_project_libs t2
        <where>
            t2.puid=#{projectId,jdbcType=VARCHAR}))
            and  (t1.P_UPDATE_TIME BETWEEN
            (SYSDATE-7) and
            (sysdate)) and
            t1.P_EBOM_STATUS = 0
        </where>
    </select>

    <!--根据零件号查询bom-->
    <select id="HzEbomRecordDAOImpl_findEbom" resultMap="BaseResultMap" parameterType="java.util.HashMap">
        SELECT t1.*from HZ_BOM_LINE_RECORD t1
        where t1.p_bom_digifax_id=(
        select t3.puid from Hz_Bom_Main_Record t3 where t3.p_cfg0_of_which_project_puid=(
        select t2.puid from Hz_project_libs t2
        <where>
            t2.puid=#{projectId,jdbcType=VARCHAR}))
            <if test="puid != null and puid!=''">
                and t1.puid = #{puid,jdbcType=VARCHAR}
            </if>
            <if test="lineID != null and lineID!=''">
                and t1.P_BOM_LINE_ID = #{lineID,jdbcType=VARCHAR}
            </if>
            <if test="parentId != null and parentId!=''">
                and t1.P_PARENT_UID = #{parentId,jdbcType=VARCHAR}
            </if>
            and t1.P_EBOM_STATUS <![CDATA[ <> ]]>0
            order by CAST(t1.P_SORT_NUM as FLOAT)
        </where>
    </select>


    <!--找出大于当前排序号的最小排序号-->
    <select id="HzEbomRecordDAOImpl_findMinOrderNumWhichGreaterThanThisOrderNum" parameterType="java.util.HashMap" resultType="java.lang.String">
        SELECT * FROM (
        SELECT P_SORT_NUM  FROM HZ_BOM_LINE_RECORD
        where p_bom_digifax_id=(
        select t3.puid from Hz_Bom_Main_Record t3 where t3.p_cfg0_of_which_project_puid=(
        select t2.puid from Hz_project_libs t2
        <where>
        t2.puid=#{projectId,jdbcType=VARCHAR}))
        </where>
        and  P_SORT_NUM &gt;#{sortNum,jdbcType=VARCHAR}
        ORDER BY  CAST(P_SORT_NUM as FLOAT))WHERE rownum =1
    </select>


    <insert id="HzEbomRecordDAOImpl_insert" parameterType="sql.pojo.epl.HzEPLManageRecord">
        insert into ${tableName}
        (
        PUID,P_PARENT_UID,P_BOM_DIGIFAX_ID,P_LINE_INDEX,P_BOM_LINE_IS_HAS,P_BOM_LINE_PUID,P_BOM_LINE_ID,
        P_BOM_LINE_IS_2Y,P_BOM_LINE_IS_PART,P_SORT_NUM,P_BOM_LINE_IS_DEPT,P_BOM_OF_WHICH_DEPT,
        P_BOM_LINE_PART_NAME,P_BOM_LINE_PART_CLASS,
        P_BOM_LINE_PART_EN_NAME,
        P_BOM_LINE_PART_RESOURCE, P_FNA_INFO, P_EBOM_STATUS,
        P_CREATE_TIME, P_UPDATE_TIME, P_FASTENER,
        P_3CPART_FLAG, P_IN_OUT_SIDE_FLAG,
        P_UPC, P_FNA_DESC, P_CREATE_NAME,
        P_UPDATE_NAME, P_UNIT, P_PICTURE_NO,
        P_PICTURE_SHEET, P_MATERIAL_HIGH, P_MATERIAL1,
        P_MATERIAL2, P_MATERIAL3, P_DENSITY,
        P_MATERIAL_STANDARD, P_SURFACE_TREAT, P_TEXTURE_COLOR_NUM,
        P_MANU_PROCESS, P_SYMMETRY, P_IMPORTANCE,
        P_REGULATION_FLAG, P_BWG_BOX_PART, P_DEVELOP_TYPE,
        P_DATA_VERSION, P_TARGET_WEIGHT, P_FEATURE_WEIGHT,
        P_ACTUAL_WEIGHT, P_FASTENER_STANDARD, P_FASTENER_LEVEL,
        P_TORQUE, P_DUTY_ENGINEER, P_SUPPLY,
        P_SUPPLY_CODE, P_REMARK, P_REGULATION_CODE,P_NUMBER,P_BUY_ENGINEER,
        P_COLOR_PART
        )
        values
        (#{puid,jdbcType=VARCHAR},#{parentUid,jdbcType=VARCHAR},#{bomDigifaxId,jdbcType=VARCHAR},
        #{lineIndex,jdbcType=VARCHAR},#{isHas,jdbcType=INTEGER},#{linePuid,jdbcType=VARCHAR},
        #{lineID,jdbcType=VARCHAR},
        #{is2Y,jdbcType=INTEGER},#{isPart,jdbcType=INTEGER},
        #{sortNum,jdbcType=VARCHAR},#{isDept,jdbcType=INTEGER},
        #{pBomOfWhichDept,jdbcType=VARCHAR},#{pBomLinePartName,jdbcType=VARCHAR},#{pBomLinePartClass,jdbcType=VARCHAR},
        #{pBomLinePartEnName,jdbcType=VARCHAR},
          #{pBomLinePartResource,jdbcType=VARCHAR}, #{fna,jdbcType=VARCHAR},#{status,jdbcType=INTEGER},
          sysdate,sysdate, #{pFastener,jdbcType=VARCHAR}, #{p3cpartFlag,jdbcType=INTEGER}, #{pInOutSideFlag,jdbcType=INTEGER},
          #{pUpc,jdbcType=VARCHAR}, #{pFnaDesc,jdbcType=VARCHAR}, #{pCreateName,jdbcType=VARCHAR},
          #{pUpdateName,jdbcType=VARCHAR}, #{pUnit,jdbcType=VARCHAR}, #{pPictureNo,jdbcType=VARCHAR},
          #{pPictureSheet,jdbcType=VARCHAR}, #{pMaterialHigh,jdbcType=VARCHAR}, #{pMaterial1,jdbcType=VARCHAR},
          #{pMaterial2,jdbcType=VARCHAR}, #{pMaterial3,jdbcType=VARCHAR}, #{pDensity,jdbcType=VARCHAR},
          #{pMaterialStandard,jdbcType=VARCHAR}, #{pSurfaceTreat,jdbcType=VARCHAR}, #{pTextureColorNum,jdbcType=VARCHAR},
          #{pManuProcess,jdbcType=VARCHAR}, #{pSymmetry,jdbcType=VARCHAR}, #{pImportance,jdbcType=VARCHAR},
          #{pRegulationFlag,jdbcType=INTEGER}, #{pBwgBoxPart,jdbcType=VARCHAR}, #{pDevelopType,jdbcType=VARCHAR},
          #{pDataVersion,jdbcType=VARCHAR}, #{pTargetWeight,jdbcType=VARCHAR}, #{pFeatureWeight,jdbcType=VARCHAR},
          #{pActualWeight,jdbcType=VARCHAR}, #{pFastenerStandard,jdbcType=VARCHAR}, #{pFastenerLevel,jdbcType=VARCHAR},
          #{pTorque,jdbcType=VARCHAR}, #{pDutyEngineer,jdbcType=VARCHAR}, #{pSupply,jdbcType=VARCHAR},
          #{pSupplyCode,jdbcType=VARCHAR}, #{pRemark,jdbcType=VARCHAR}, #{pRegulationCode,jdbcType=VARCHAR},
          #{number,jdbcType=VARCHAR},#{pBuyEngineer,jdbcType=VARCHAR},#{colorPart,jdbcType=INTEGER}
      )

    </insert>

    <!--导入excel文件到EBOM写的批量插入-->
    <insert id="HzEbomRecordDAOImpl_importList" parameterType="java.util.List">
        insert into HZ_BOM_LINE_RECORD
        (
        PUID,P_PARENT_UID,P_BOM_DIGIFAX_ID,P_LINE_INDEX,P_BOM_LINE_IS_HAS,P_BOM_LINE_PUID,P_BOM_LINE_ID,
        P_BOM_LINE_IS_2Y,P_BOM_LINE_IS_PART,P_SORT_NUM,P_BOM_OF_WHICH_DEPT,
        P_BOM_LINE_PART_NAME,P_BOM_LINE_PART_CLASS,
        P_BOM_LINE_PART_EN_NAME,
        P_BOM_LINE_PART_RESOURCE, P_FNA_INFO, P_EBOM_STATUS,
        P_CREATE_TIME, P_UPDATE_TIME, P_FASTENER,
        P_3CPART_FLAG, P_IN_OUT_SIDE_FLAG,
        P_UPC, P_FNA_DESC, P_CREATE_NAME,
        P_UPDATE_NAME, P_UNIT, P_PICTURE_NO,
        P_PICTURE_SHEET, P_MATERIAL_HIGH, P_MATERIAL1,
        P_MATERIAL2, P_MATERIAL3, P_DENSITY,
        P_MATERIAL_STANDARD, P_SURFACE_TREAT, P_TEXTURE_COLOR_NUM,
        P_MANU_PROCESS, P_SYMMETRY, P_IMPORTANCE,
        P_REGULATION_FLAG, P_BWG_BOX_PART, P_DEVELOP_TYPE,
        P_DATA_VERSION, P_TARGET_WEIGHT, P_FEATURE_WEIGHT,
        P_ACTUAL_WEIGHT, P_FASTENER_STANDARD, P_FASTENER_LEVEL,
        P_TORQUE, P_DUTY_ENGINEER, P_SUPPLY,
        P_SUPPLY_CODE, P_REMARK, P_REGULATION_CODE,P_NUMBER,P_BUY_ENGINEER,P_COLOR_PART
        )
        <foreach collection="list" item="item" index="index" separator="UNION ALL">
            select
            #{item.puid,jdbcType=VARCHAR},#{item.parentId,jdbcType=VARCHAR},#{item.bomDigifaxId,jdbcType=VARCHAR},
            #{item.lineIndex,jdbcType=VARCHAR},#{item.isHas,jdbcType=INTEGER},#{item.linePuid,jdbcType=VARCHAR},
            #{item.lineId,jdbcType=VARCHAR},#{item.is2Y,jdbcType=INTEGER},#{item.isPart,jdbcType=INTEGER},
            #{item.sortNum,jdbcType=VARCHAR},#{item.pBomOfWhichDept,jdbcType=VARCHAR},#{item.pBomLinePartName,jdbcType=VARCHAR},
            #{item.pBomLinePartClass,jdbcType=VARCHAR},#{item.pBomLinePartEnName,jdbcType=VARCHAR},
            #{item.pBomLinePartResource,jdbcType=VARCHAR}, #{item.pFnaInfo,jdbcType=VARCHAR},1,
            sysdate,sysdate, #{item.pFastener,jdbcType=VARCHAR}, #{item.p3cpartFlag,jdbcType=INTEGER}, #{item.pInOutSideFlag,jdbcType=INTEGER},
            #{item.pUpc,jdbcType=VARCHAR}, #{item.pFnaDesc,jdbcType=VARCHAR}, #{item.pCreateName,jdbcType=VARCHAR},
            #{item.pUpdateName,jdbcType=VARCHAR}, #{item.pUnit,jdbcType=VARCHAR}, #{item.pPictureNo,jdbcType=VARCHAR},
            #{item.pPictureSheet,jdbcType=VARCHAR}, #{item.pMaterialHigh,jdbcType=VARCHAR}, #{item.pMaterial1,jdbcType=VARCHAR},
            #{item.pMaterial2,jdbcType=VARCHAR}, #{item.pMaterial3,jdbcType=VARCHAR}, #{item.pDensity,jdbcType=VARCHAR},
            #{item.pMaterialStandard,jdbcType=VARCHAR}, #{item.pSurfaceTreat,jdbcType=VARCHAR}, #{item.pTextureColorNum,jdbcType=VARCHAR},
            #{item.pManuProcess,jdbcType=VARCHAR}, #{item.pSymmetry,jdbcType=VARCHAR}, #{item.pImportance,jdbcType=VARCHAR},
            #{item.pRegulationFlag,jdbcType=INTEGER}, #{item.pBwgBoxPart,jdbcType=VARCHAR}, #{item.pDevelopType,jdbcType=VARCHAR},
            #{item.pDataVersion,jdbcType=VARCHAR}, #{item.pTargetWeight,jdbcType=VARCHAR}, #{item.pFeatureWeight,jdbcType=VARCHAR},
            #{item.pActualWeight,jdbcType=VARCHAR}, #{item.pFastenerStandard,jdbcType=VARCHAR}, #{item.pFastenerLevel,jdbcType=VARCHAR},
            #{item.pTorque,jdbcType=VARCHAR}, #{item.pDutyEngineer,jdbcType=VARCHAR}, #{item.pSupply,jdbcType=VARCHAR},
            #{item.pSupplyCode,jdbcType=VARCHAR}, #{item.pRemark,jdbcType=VARCHAR}, #{item.pRegulationCode,jdbcType=VARCHAR},
            #{item.number,jdbcType=VARCHAR},#{item.pBuyEngineer,jdbcType=VARCHAR},#{item.colorPart,jdbcType=INTEGER}
            from DUAL
        </foreach>
    </insert>


    <select id="HzEbomRecordDAOImpl_sortNumRepeat" parameterType="java.util.HashMap" resultType="java.lang.Integer">
        select count(*) from HZ_BOM_LINE_RECORD t1
        where t1.p_bom_digifax_id=(
        select t3.puid from Hz_Bom_Main_Record t3 where t3.p_cfg0_of_which_project_puid=(
        select t2.puid from Hz_project_libs t2
        <where>
        t2.puid=#{projectId,jdbcType=VARCHAR}))
            and P_SORT_NUM = #{sortNum,jdbcType=VARCHAR}
            and t1.P_EBOM_STATUS <![CDATA[ <> ]]>0
        </where>
    </select>



    <select id="HzEbomRecordDAOImpl_lineIndexRepeat" parameterType="java.util.HashMap" resultType="java.lang.Integer">
        select count(*) from HZ_BOM_LINE_RECORD t1
        where t1.p_bom_digifax_id=(
        select t3.puid from Hz_Bom_Main_Record t3 where t3.p_cfg0_of_which_project_puid=(
        select t2.puid from Hz_project_libs t2
        <where>
            t2.puid=#{projectId,jdbcType=VARCHAR}))
            and P_LINE_INDEX = #{lineIndex,jdbcType=VARCHAR}
            and t1.P_EBOM_STATUS <![CDATA[ <> ]]>0
        </where>
    </select>


    <select id="HzEbomRecordDAOImpl_getAll2YBomRecord" parameterType="java.util.HashMap" resultMap="BaseResultMap">
        select * from HZ_BOM_LINE_RECORD t1
        where t1.p_bom_digifax_id=(
        select t3.puid from Hz_Bom_Main_Record t3 where t3.p_cfg0_of_which_project_puid=(
        select t2.puid from Hz_project_libs t2
        <where>
            t2.puid=#{projectId,jdbcType=VARCHAR}))
            <if test="colorPart != null">
                and t1.P_COLOR_PART = #{colorPart,jdbcType=INTEGER}
            </if>
            and t1.P_BOM_LINE_IS_2Y=1
        </where>
    </select>

    <!--获取除变形外的相同的零件号-->
    <select id="HzEbomRecordDAOImpl_getSameNameLineId" parameterType="java.util.HashMap" resultMap="BaseResultMap">
        select * from HZ_BOM_LINE_RECORD t1
        where t1.p_bom_digifax_id=(
        select t3.puid from Hz_Bom_Main_Record t3 where t3.p_cfg0_of_which_project_puid=(
        select t2.puid from Hz_project_libs t2
        <where>
            t2.puid=#{projectId,jdbcType=VARCHAR}))
            <if test="lineId != null and lineId!=''" >
                and t1.P_BOM_LINE_ID like CONCAT(CONCAT('%',#{lineId,jdbcType=VARCHAR}),'%')
            </if>
        </where>
    </select>

    <!--查询油漆车身总成和白车身总成-->
    <select id="HzEbomRecordDAOImpl_getPaintAndWhiteBody" parameterType="java.util.HashMap" resultMap="BaseResultMap">
        SELECT t1.* from HZ_BOM_LINE_RECORD t1
        where t1.p_bom_digifax_id=(
        select t3.puid from Hz_Bom_Main_Record t3 where t3.p_cfg0_of_which_project_puid=(
        select t2.puid from Hz_project_libs t2
        <where>
            t2.puid=#{projectId,jdbcType=VARCHAR}))
            and (t1.P_BOM_LINE_PART_NAME like '白车身总成%'
            or t1.P_BOM_LINE_PART_NAME like '油漆车身总成%')

            and (t1.P_BOM_LINE_PART_RESOURCE ='采购件'or
            t1.P_BOM_LINE_PART_RESOURCE ='自制总成' or
            t1.P_BOM_LINE_PART_RESOURCE ='自制单件'or
            t1.P_BOM_LINE_PART_RESOURCE ='自用标准件'or
            t1.P_BOM_LINE_PART_RESOURCE ='自用非标件'or
            t1.P_BOM_LINE_PART_RESOURCE ='虚拟总成')
        </where>
        start with t1.puid = #{puid,jdbcType=VARCHAR} and t1.P_EBOM_STATUS<![CDATA[ <> ]]>0
        connect by prior t1.puid = t1.p_parent_uid  and t1.P_EBOM_STATUS<![CDATA[ <> ]]>0
        order by CAST(t1.P_SORT_NUM as FLOAT)
    </select>
</mapper>